{"version":3,"sources":["src/js/FlyControls.js"],"names":["THREE","FlyControls","object","domElement","undefined","console","warn","document","setAttribute","movementSpeed","rollSpeed","dragToLook","autoForward","tmpQuaternion","Quaternion","mouseStatus","moveState","up","down","left","right","forward","back","pitchUp","pitchDown","yawLeft","yawRight","rollLeft","rollRight","moveVector","Vector3","rotationVector","keydown","event","altKey","keyCode","movementSpeedMultiplier","updateMovementVector","updateRotationVector","keyup","mousedown","focus","preventDefault","stopPropagation","button","mousemove","container","getContainerDimensions","halfWidth","size","halfHeight","pageX","offset","pageY","mouseup","update","delta","moveMult","rotMult","translateX","x","translateY","y","translateZ","z","set","normalize","quaternion","multiply","rotation","setFromQuaternion","order","offsetWidth","offsetHeight","offsetLeft","offsetTop","window","innerWidth","innerHeight","bind","scope","fn","apply","arguments","contextmenu","dispose","removeEventListener","_mousedown","_mousemove","_mouseup","_keydown","_keyup","addEventListener"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;AAIAA,KAAK,CAACC,WAAN,GAAoB,UAAWC,MAAX,EAAmBC,UAAnB,EAAgC;AAEnD,MAAKA,UAAU,KAAKC,SAApB,EAAgC;AAE/BC,IAAAA,OAAO,CAACC,IAAR,CAAc,wEAAd;AACAH,IAAAA,UAAU,GAAGI,QAAb;AAEA;;AAED,OAAKL,MAAL,GAAcA,MAAd;AACA,OAAKC,UAAL,GAAkBA,UAAlB;AAEA,MAAKA,UAAL,EAAkB,KAAKA,UAAL,CAAgBK,YAAhB,CAA8B,UAA9B,EAA0C,CAAE,CAA5C,EAZiC,CAcnD;;AAEA,OAAKC,aAAL,GAAqB,GAArB;AACA,OAAKC,SAAL,GAAiB,KAAjB;AAEA,OAAKC,UAAL,GAAkB,KAAlB;AACA,OAAKC,WAAL,GAAmB,KAAnB,CApBmD,CAsBnD;AAEA;;AAEA,OAAKC,aAAL,GAAqB,IAAIb,KAAK,CAACc,UAAV,EAArB;AAEA,OAAKC,WAAL,GAAmB,CAAnB;AAEA,OAAKC,SAAL,GAAiB;AAAEC,IAAAA,EAAE,EAAE,CAAN;AAASC,IAAAA,IAAI,EAAE,CAAf;AAAkBC,IAAAA,IAAI,EAAE,CAAxB;AAA2BC,IAAAA,KAAK,EAAE,CAAlC;AAAqCC,IAAAA,OAAO,EAAE,CAA9C;AAAiDC,IAAAA,IAAI,EAAE,CAAvD;AAA0DC,IAAAA,OAAO,EAAE,CAAnE;AAAsEC,IAAAA,SAAS,EAAE,CAAjF;AAAoFC,IAAAA,OAAO,EAAE,CAA7F;AAAgGC,IAAAA,QAAQ,EAAE,CAA1G;AAA6GC,IAAAA,QAAQ,EAAE,CAAvH;AAA0HC,IAAAA,SAAS,EAAE;AAArI,GAAjB;AACA,OAAKC,UAAL,GAAkB,IAAI7B,KAAK,CAAC8B,OAAV,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,CAAlB;AACA,OAAKC,cAAL,GAAsB,IAAI/B,KAAK,CAAC8B,OAAV,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,CAAtB;;AAEA,OAAKE,OAAL,GAAe,UAAWC,KAAX,EAAmB;AAEjC,QAAKA,KAAK,CAACC,MAAX,EAAoB;AAEnB;AAEA,KANgC,CAQjC;;;AAEA,YAASD,KAAK,CAACE,OAAf;AAEC,WAAK,EAAL;AAAS;AAAY,aAAKC,uBAAL,GAA+B,EAA/B;AAAmC;;AAExD,WAAK,EAAL;AAAS;AAAM,aAAKpB,SAAL,CAAeK,OAAf,GAAyB,CAAzB;AAA4B;;AAC3C,WAAK,EAAL;AAAS;AAAM,aAAKL,SAAL,CAAeM,IAAf,GAAsB,CAAtB;AAAyB;;AAExC,WAAK,EAAL;AAAS;AAAM,aAAKN,SAAL,CAAeG,IAAf,GAAsB,CAAtB;AAAyB;;AACxC,WAAK,EAAL;AAAS;AAAM,aAAKH,SAAL,CAAeI,KAAf,GAAuB,CAAvB;AAA0B;;AAEzC,WAAK,EAAL;AAAS;AAAM,aAAKJ,SAAL,CAAeC,EAAf,GAAoB,CAApB;AAAuB;;AACtC,WAAK,EAAL;AAAS;AAAM,aAAKD,SAAL,CAAeE,IAAf,GAAsB,CAAtB;AAAyB;;AAExC,WAAK,EAAL;AAAS;AAAO,aAAKF,SAAL,CAAeO,OAAf,GAAyB,CAAzB;AAA4B;;AAC5C,WAAK,EAAL;AAAS;AAAS,aAAKP,SAAL,CAAeQ,SAAf,GAA2B,CAA3B;AAA8B;;AAEhD,WAAK,EAAL;AAAS;AAAS,aAAKR,SAAL,CAAeS,OAAf,GAAyB,CAAzB;AAA4B;;AAC9C,WAAK,EAAL;AAAS;AAAU,aAAKT,SAAL,CAAeU,QAAf,GAA0B,CAA1B;AAA6B;;AAEhD,WAAK,EAAL;AAAS;AAAM,aAAKV,SAAL,CAAeW,QAAf,GAA0B,CAA1B;AAA6B;;AAC5C,WAAK,EAAL;AAAS;AAAM,aAAKX,SAAL,CAAeY,SAAf,GAA2B,CAA3B;AAA8B;AApB9C;;AAwBA,SAAKS,oBAAL;AACA,SAAKC,oBAAL;AAEA,GArCD;;AAuCA,OAAKC,KAAL,GAAa,UAAWN,KAAX,EAAmB;AAE/B,YAASA,KAAK,CAACE,OAAf;AAEC,WAAK,EAAL;AAAS;AAAY,aAAKC,uBAAL,GAA+B,CAA/B;AAAkC;;AAEvD,WAAK,EAAL;AAAS;AAAM,aAAKpB,SAAL,CAAeK,OAAf,GAAyB,CAAzB;AAA4B;;AAC3C,WAAK,EAAL;AAAS;AAAM,aAAKL,SAAL,CAAeM,IAAf,GAAsB,CAAtB;AAAyB;;AAExC,WAAK,EAAL;AAAS;AAAM,aAAKN,SAAL,CAAeG,IAAf,GAAsB,CAAtB;AAAyB;;AACxC,WAAK,EAAL;AAAS;AAAM,aAAKH,SAAL,CAAeI,KAAf,GAAuB,CAAvB;AAA0B;;AAEzC,WAAK,EAAL;AAAS;AAAM,aAAKJ,SAAL,CAAeC,EAAf,GAAoB,CAApB;AAAuB;;AACtC,WAAK,EAAL;AAAS;AAAM,aAAKD,SAAL,CAAeE,IAAf,GAAsB,CAAtB;AAAyB;;AAExC,WAAK,EAAL;AAAS;AAAO,aAAKF,SAAL,CAAeO,OAAf,GAAyB,CAAzB;AAA4B;;AAC5C,WAAK,EAAL;AAAS;AAAS,aAAKP,SAAL,CAAeQ,SAAf,GAA2B,CAA3B;AAA8B;;AAEhD,WAAK,EAAL;AAAS;AAAS,aAAKR,SAAL,CAAeS,OAAf,GAAyB,CAAzB;AAA4B;;AAC9C,WAAK,EAAL;AAAS;AAAU,aAAKT,SAAL,CAAeU,QAAf,GAA0B,CAA1B;AAA6B;;AAEhD,WAAK,EAAL;AAAS;AAAM,aAAKV,SAAL,CAAeW,QAAf,GAA0B,CAA1B;AAA6B;;AAC5C,WAAK,EAAL;AAAS;AAAM,aAAKX,SAAL,CAAeY,SAAf,GAA2B,CAA3B;AAA8B;AApB9C;;AAwBA,SAAKS,oBAAL;AACA,SAAKC,oBAAL;AAEA,GA7BD;;AA+BA,OAAKE,SAAL,GAAiB,UAAWP,KAAX,EAAmB;AAEnC,QAAK,KAAK9B,UAAL,KAAoBI,QAAzB,EAAoC;AAEnC,WAAKJ,UAAL,CAAgBsC,KAAhB;AAEA;;AAEDR,IAAAA,KAAK,CAACS,cAAN;AACAT,IAAAA,KAAK,CAACU,eAAN;;AAEA,QAAK,KAAKhC,UAAV,EAAuB;AAEtB,WAAKI,WAAL;AAEA,KAJD,MAIO;AAEN,cAASkB,KAAK,CAACW,MAAf;AAEC,aAAK,CAAL;AAAQ,eAAK5B,SAAL,CAAeK,OAAf,GAAyB,CAAzB;AAA4B;;AACpC,aAAK,CAAL;AAAQ,eAAKL,SAAL,CAAeM,IAAf,GAAsB,CAAtB;AAAyB;AAHlC;;AAOA,WAAKe,oBAAL;AAEA;AAED,GA5BD;;AA8BA,OAAKQ,SAAL,GAAiB,UAAWZ,KAAX,EAAmB;AAEnC,QAAK,CAAE,KAAKtB,UAAP,IAAqB,KAAKI,WAAL,GAAmB,CAA7C,EAAiD;AAEhD,UAAI+B,SAAS,GAAG,KAAKC,sBAAL,EAAhB;AACA,UAAIC,SAAS,GAAGF,SAAS,CAACG,IAAV,CAAgB,CAAhB,IAAsB,CAAtC;AACA,UAAIC,UAAU,GAAGJ,SAAS,CAACG,IAAV,CAAgB,CAAhB,IAAsB,CAAvC;AAEA,WAAKjC,SAAL,CAAeS,OAAf,GAAyB,EAAMQ,KAAK,CAACkB,KAAN,GAAcL,SAAS,CAACM,MAAV,CAAkB,CAAlB,CAAhB,GAA0CJ,SAA9C,IAA4DA,SAArF;AACA,WAAKhC,SAAL,CAAeQ,SAAf,GAA2B,CAAIS,KAAK,CAACoB,KAAN,GAAcP,SAAS,CAACM,MAAV,CAAkB,CAAlB,CAAhB,GAA0CF,UAA5C,IAA2DA,UAAtF;AAEA,WAAKZ,oBAAL;AAEA;AAED,GAfD;;AAiBA,OAAKgB,OAAL,GAAe,UAAWrB,KAAX,EAAmB;AAEjCA,IAAAA,KAAK,CAACS,cAAN;AACAT,IAAAA,KAAK,CAACU,eAAN;;AAEA,QAAK,KAAKhC,UAAV,EAAuB;AAEtB,WAAKI,WAAL;AAEA,WAAKC,SAAL,CAAeS,OAAf,GAAyB,KAAKT,SAAL,CAAeQ,SAAf,GAA2B,CAApD;AAEA,KAND,MAMO;AAEN,cAASS,KAAK,CAACW,MAAf;AAEC,aAAK,CAAL;AAAQ,eAAK5B,SAAL,CAAeK,OAAf,GAAyB,CAAzB;AAA4B;;AACpC,aAAK,CAAL;AAAQ,eAAKL,SAAL,CAAeM,IAAf,GAAsB,CAAtB;AAAyB;AAHlC;;AAOA,WAAKe,oBAAL;AAEA;;AAED,SAAKC,oBAAL;AAEA,GA1BD;;AA4BA,OAAKiB,MAAL,GAAc,UAAWC,KAAX,EAAmB;AAEhC,QAAIC,QAAQ,GAAGD,KAAK,GAAG,KAAK/C,aAA5B;AACA,QAAIiD,OAAO,GAAGF,KAAK,GAAG,KAAK9C,SAA3B;AAEA,SAAKR,MAAL,CAAYyD,UAAZ,CAAwB,KAAK9B,UAAL,CAAgB+B,CAAhB,GAAoBH,QAA5C;AACA,SAAKvD,MAAL,CAAY2D,UAAZ,CAAwB,KAAKhC,UAAL,CAAgBiC,CAAhB,GAAoBL,QAA5C;AACA,SAAKvD,MAAL,CAAY6D,UAAZ,CAAwB,KAAKlC,UAAL,CAAgBmC,CAAhB,GAAoBP,QAA5C;AAEA,SAAK5C,aAAL,CAAmBoD,GAAnB,CAAwB,KAAKlC,cAAL,CAAoB6B,CAApB,GAAwBF,OAAhD,EAAyD,KAAK3B,cAAL,CAAoB+B,CAApB,GAAwBJ,OAAjF,EAA0F,KAAK3B,cAAL,CAAoBiC,CAApB,GAAwBN,OAAlH,EAA2H,CAA3H,EAA+HQ,SAA/H;AACA,SAAKhE,MAAL,CAAYiE,UAAZ,CAAuBC,QAAvB,CAAiC,KAAKvD,aAAtC,EAVgC,CAYhC;;AACA,SAAKX,MAAL,CAAYmE,QAAZ,CAAqBC,iBAArB,CAAwC,KAAKpE,MAAL,CAAYiE,UAApD,EAAgE,KAAKjE,MAAL,CAAYmE,QAAZ,CAAqBE,KAArF;AAGA,GAhBD;;AAkBA,OAAKlC,oBAAL,GAA4B,YAAY;AAEvC,QAAIhB,OAAO,GAAK,KAAKL,SAAL,CAAeK,OAAf,IAA4B,KAAKT,WAAL,IAAoB,CAAE,KAAKI,SAAL,CAAeM,IAAnE,GAA8E,CAA9E,GAAkF,CAAhG;AAEA,SAAKO,UAAL,CAAgB+B,CAAhB,GAAsB,CAAE,KAAK5C,SAAL,CAAeG,IAAjB,GAAwB,KAAKH,SAAL,CAAeI,KAA7D;AACA,SAAKS,UAAL,CAAgBiC,CAAhB,GAAsB,CAAE,KAAK9C,SAAL,CAAeE,IAAjB,GAAwB,KAAKF,SAAL,CAAeC,EAA7D;AACA,SAAKY,UAAL,CAAgBmC,CAAhB,GAAsB,CAAE3C,OAAF,GAAY,KAAKL,SAAL,CAAeM,IAAjD,CANuC,CAQvC;AAEA,GAVD;;AAYA,OAAKgB,oBAAL,GAA4B,YAAY;AAEvC,SAAKP,cAAL,CAAoB6B,CAApB,GAA0B,CAAE,KAAK5C,SAAL,CAAeQ,SAAjB,GAA6B,KAAKR,SAAL,CAAeO,OAAtE;AACA,SAAKQ,cAAL,CAAoB+B,CAApB,GAA0B,CAAE,KAAK9C,SAAL,CAAeU,QAAjB,GAA4B,KAAKV,SAAL,CAAeS,OAArE;AACA,SAAKM,cAAL,CAAoBiC,CAApB,GAA0B,CAAE,KAAKhD,SAAL,CAAeY,SAAjB,GAA6B,KAAKZ,SAAL,CAAeW,QAAtE,CAJuC,CAMvC;AAEA,GARD;;AAUA,OAAKoB,sBAAL,GAA8B,YAAY;AAEzC,QAAK,KAAK5C,UAAL,IAAmBI,QAAxB,EAAmC;AAElC,aAAO;AACN0C,QAAAA,IAAI,EAAE,CAAE,KAAK9C,UAAL,CAAgBqE,WAAlB,EAA+B,KAAKrE,UAAL,CAAgBsE,YAA/C,CADA;AAENrB,QAAAA,MAAM,EAAE,CAAE,KAAKjD,UAAL,CAAgBuE,UAAlB,EAA8B,KAAKvE,UAAL,CAAgBwE,SAA9C;AAFF,OAAP;AAKA,KAPD,MAOO;AAEN,aAAO;AACN1B,QAAAA,IAAI,EAAE,CAAE2B,MAAM,CAACC,UAAT,EAAqBD,MAAM,CAACE,WAA5B,CADA;AAEN1B,QAAAA,MAAM,EAAE,CAAE,CAAF,EAAK,CAAL;AAFF,OAAP;AAKA;AAED,GAlBD;;AAoBA,WAAS2B,IAAT,CAAeC,KAAf,EAAsBC,EAAtB,EAA2B;AAE1B,WAAO,YAAY;AAElBA,MAAAA,EAAE,CAACC,KAAH,CAAUF,KAAV,EAAiBG,SAAjB;AAEA,KAJD;AAMA;;AAED,WAASC,WAAT,CAAsBnD,KAAtB,EAA8B;AAE7BA,IAAAA,KAAK,CAACS,cAAN;AAEA;;AAED,OAAK2C,OAAL,GAAe,YAAY;AAE1B,SAAKlF,UAAL,CAAgBmF,mBAAhB,CAAqC,aAArC,EAAoDF,WAApD,EAAiE,KAAjE;AACA,SAAKjF,UAAL,CAAgBmF,mBAAhB,CAAqC,WAArC,EAAkDC,UAAlD,EAA8D,KAA9D;AACA,SAAKpF,UAAL,CAAgBmF,mBAAhB,CAAqC,WAArC,EAAkDE,UAAlD,EAA8D,KAA9D;AACA,SAAKrF,UAAL,CAAgBmF,mBAAhB,CAAqC,SAArC,EAAgDG,QAAhD,EAA0D,KAA1D;AAEAb,IAAAA,MAAM,CAACU,mBAAP,CAA4B,SAA5B,EAAuCI,QAAvC,EAAiD,KAAjD;AACAd,IAAAA,MAAM,CAACU,mBAAP,CAA4B,OAA5B,EAAqCK,MAArC,EAA6C,KAA7C;AAEA,GAVD;;AAYA,MAAIH,UAAU,GAAGT,IAAI,CAAE,IAAF,EAAQ,KAAKlC,SAAb,CAArB;;AACA,MAAI0C,UAAU,GAAGR,IAAI,CAAE,IAAF,EAAQ,KAAKvC,SAAb,CAArB;;AACA,MAAIiD,QAAQ,GAAGV,IAAI,CAAE,IAAF,EAAQ,KAAKzB,OAAb,CAAnB;;AACA,MAAIoC,QAAQ,GAAGX,IAAI,CAAE,IAAF,EAAQ,KAAK/C,OAAb,CAAnB;;AACA,MAAI2D,MAAM,GAAGZ,IAAI,CAAE,IAAF,EAAQ,KAAKxC,KAAb,CAAjB;;AAEA,OAAKpC,UAAL,CAAgByF,gBAAhB,CAAkC,aAAlC,EAAiDR,WAAjD,EAA8D,KAA9D;AAEA,OAAKjF,UAAL,CAAgByF,gBAAhB,CAAkC,WAAlC,EAA+CJ,UAA/C,EAA2D,KAA3D;AACA,OAAKrF,UAAL,CAAgByF,gBAAhB,CAAkC,WAAlC,EAA+CL,UAA/C,EAA2D,KAA3D;AACA,OAAKpF,UAAL,CAAgByF,gBAAhB,CAAkC,SAAlC,EAA6CH,QAA7C,EAAuD,KAAvD;AAEAb,EAAAA,MAAM,CAACgB,gBAAP,CAAyB,SAAzB,EAAoCF,QAApC,EAA8C,KAA9C;AACAd,EAAAA,MAAM,CAACgB,gBAAP,CAAyB,OAAzB,EAAkCD,MAAlC,EAA0C,KAA1C;AAEA,OAAKtD,oBAAL;AACA,OAAKC,oBAAL;AAEA,CA7RD","file":"FlyControls.map","sourceRoot":"..","sourcesContent":["/**\n * @author James Baicoianu / http://www.baicoianu.com/\n */\n\nTHREE.FlyControls = function ( object, domElement ) {\n\n\tif ( domElement === undefined ) {\n\n\t\tconsole.warn( 'THREE.FlyControls: The second parameter \"domElement\" is now mandatory.' );\n\t\tdomElement = document;\n\n\t}\n\n\tthis.object = object;\n\tthis.domElement = domElement;\n\n\tif ( domElement ) this.domElement.setAttribute( 'tabindex', - 1 );\n\n\t// API\n\n\tthis.movementSpeed = 1.0;\n\tthis.rollSpeed = 0.005;\n\n\tthis.dragToLook = false;\n\tthis.autoForward = false;\n\n\t// disable default target object behavior\n\n\t// internals\n\n\tthis.tmpQuaternion = new THREE.Quaternion();\n\n\tthis.mouseStatus = 0;\n\n\tthis.moveState = { up: 0, down: 0, left: 0, right: 0, forward: 0, back: 0, pitchUp: 0, pitchDown: 0, yawLeft: 0, yawRight: 0, rollLeft: 0, rollRight: 0 };\n\tthis.moveVector = new THREE.Vector3( 0, 0, 0 );\n\tthis.rotationVector = new THREE.Vector3( 0, 0, 0 );\n\n\tthis.keydown = function ( event ) {\n\n\t\tif ( event.altKey ) {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\t//event.preventDefault();\n\n\t\tswitch ( event.keyCode ) {\n\n\t\t\tcase 16: /* shift */ this.movementSpeedMultiplier = .1; break;\n\n\t\t\tcase 87: /*W*/ this.moveState.forward = 1; break;\n\t\t\tcase 83: /*S*/ this.moveState.back = 1; break;\n\n\t\t\tcase 65: /*A*/ this.moveState.left = 1; break;\n\t\t\tcase 68: /*D*/ this.moveState.right = 1; break;\n\n\t\t\tcase 82: /*R*/ this.moveState.up = 1; break;\n\t\t\tcase 70: /*F*/ this.moveState.down = 1; break;\n\n\t\t\tcase 38: /*up*/ this.moveState.pitchUp = 1; break;\n\t\t\tcase 40: /*down*/ this.moveState.pitchDown = 1; break;\n\n\t\t\tcase 37: /*left*/ this.moveState.yawLeft = 1; break;\n\t\t\tcase 39: /*right*/ this.moveState.yawRight = 1; break;\n\n\t\t\tcase 81: /*Q*/ this.moveState.rollLeft = 1; break;\n\t\t\tcase 69: /*E*/ this.moveState.rollRight = 1; break;\n\n\t\t}\n\n\t\tthis.updateMovementVector();\n\t\tthis.updateRotationVector();\n\n\t};\n\n\tthis.keyup = function ( event ) {\n\n\t\tswitch ( event.keyCode ) {\n\n\t\t\tcase 16: /* shift */ this.movementSpeedMultiplier = 1; break;\n\n\t\t\tcase 87: /*W*/ this.moveState.forward = 0; break;\n\t\t\tcase 83: /*S*/ this.moveState.back = 0; break;\n\n\t\t\tcase 65: /*A*/ this.moveState.left = 0; break;\n\t\t\tcase 68: /*D*/ this.moveState.right = 0; break;\n\n\t\t\tcase 82: /*R*/ this.moveState.up = 0; break;\n\t\t\tcase 70: /*F*/ this.moveState.down = 0; break;\n\n\t\t\tcase 38: /*up*/ this.moveState.pitchUp = 0; break;\n\t\t\tcase 40: /*down*/ this.moveState.pitchDown = 0; break;\n\n\t\t\tcase 37: /*left*/ this.moveState.yawLeft = 0; break;\n\t\t\tcase 39: /*right*/ this.moveState.yawRight = 0; break;\n\n\t\t\tcase 81: /*Q*/ this.moveState.rollLeft = 0; break;\n\t\t\tcase 69: /*E*/ this.moveState.rollRight = 0; break;\n\n\t\t}\n\n\t\tthis.updateMovementVector();\n\t\tthis.updateRotationVector();\n\n\t};\n\n\tthis.mousedown = function ( event ) {\n\n\t\tif ( this.domElement !== document ) {\n\n\t\t\tthis.domElement.focus();\n\n\t\t}\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif ( this.dragToLook ) {\n\n\t\t\tthis.mouseStatus ++;\n\n\t\t} else {\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase 0: this.moveState.forward = 1; break;\n\t\t\t\tcase 2: this.moveState.back = 1; break;\n\n\t\t\t}\n\n\t\t\tthis.updateMovementVector();\n\n\t\t}\n\n\t};\n\n\tthis.mousemove = function ( event ) {\n\n\t\tif ( ! this.dragToLook || this.mouseStatus > 0 ) {\n\n\t\t\tvar container = this.getContainerDimensions();\n\t\t\tvar halfWidth = container.size[ 0 ] / 2;\n\t\t\tvar halfHeight = container.size[ 1 ] / 2;\n\n\t\t\tthis.moveState.yawLeft = - ( ( event.pageX - container.offset[ 0 ] ) - halfWidth ) / halfWidth;\n\t\t\tthis.moveState.pitchDown = ( ( event.pageY - container.offset[ 1 ] ) - halfHeight ) / halfHeight;\n\n\t\t\tthis.updateRotationVector();\n\n\t\t}\n\n\t};\n\n\tthis.mouseup = function ( event ) {\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif ( this.dragToLook ) {\n\n\t\t\tthis.mouseStatus --;\n\n\t\t\tthis.moveState.yawLeft = this.moveState.pitchDown = 0;\n\n\t\t} else {\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase 0: this.moveState.forward = 0; break;\n\t\t\t\tcase 2: this.moveState.back = 0; break;\n\n\t\t\t}\n\n\t\t\tthis.updateMovementVector();\n\n\t\t}\n\n\t\tthis.updateRotationVector();\n\n\t};\n\n\tthis.update = function ( delta ) {\n\n\t\tvar moveMult = delta * this.movementSpeed;\n\t\tvar rotMult = delta * this.rollSpeed;\n\n\t\tthis.object.translateX( this.moveVector.x * moveMult );\n\t\tthis.object.translateY( this.moveVector.y * moveMult );\n\t\tthis.object.translateZ( this.moveVector.z * moveMult );\n\n\t\tthis.tmpQuaternion.set( this.rotationVector.x * rotMult, this.rotationVector.y * rotMult, this.rotationVector.z * rotMult, 1 ).normalize();\n\t\tthis.object.quaternion.multiply( this.tmpQuaternion );\n\n\t\t// expose the rotation vector for convenience\n\t\tthis.object.rotation.setFromQuaternion( this.object.quaternion, this.object.rotation.order );\n\n\n\t};\n\n\tthis.updateMovementVector = function () {\n\n\t\tvar forward = ( this.moveState.forward || ( this.autoForward && ! this.moveState.back ) ) ? 1 : 0;\n\n\t\tthis.moveVector.x = ( - this.moveState.left + this.moveState.right );\n\t\tthis.moveVector.y = ( - this.moveState.down + this.moveState.up );\n\t\tthis.moveVector.z = ( - forward + this.moveState.back );\n\n\t\t//console.log( 'move:', [ this.moveVector.x, this.moveVector.y, this.moveVector.z ] );\n\n\t};\n\n\tthis.updateRotationVector = function () {\n\n\t\tthis.rotationVector.x = ( - this.moveState.pitchDown + this.moveState.pitchUp );\n\t\tthis.rotationVector.y = ( - this.moveState.yawRight + this.moveState.yawLeft );\n\t\tthis.rotationVector.z = ( - this.moveState.rollRight + this.moveState.rollLeft );\n\n\t\t//console.log( 'rotate:', [ this.rotationVector.x, this.rotationVector.y, this.rotationVector.z ] );\n\n\t};\n\n\tthis.getContainerDimensions = function () {\n\n\t\tif ( this.domElement != document ) {\n\n\t\t\treturn {\n\t\t\t\tsize: [ this.domElement.offsetWidth, this.domElement.offsetHeight ],\n\t\t\t\toffset: [ this.domElement.offsetLeft, this.domElement.offsetTop ]\n\t\t\t};\n\n\t\t} else {\n\n\t\t\treturn {\n\t\t\t\tsize: [ window.innerWidth, window.innerHeight ],\n\t\t\t\toffset: [ 0, 0 ]\n\t\t\t};\n\n\t\t}\n\n\t};\n\n\tfunction bind( scope, fn ) {\n\n\t\treturn function () {\n\n\t\t\tfn.apply( scope, arguments );\n\n\t\t};\n\n\t}\n\n\tfunction contextmenu( event ) {\n\n\t\tevent.preventDefault();\n\n\t}\n\n\tthis.dispose = function () {\n\n\t\tthis.domElement.removeEventListener( 'contextmenu', contextmenu, false );\n\t\tthis.domElement.removeEventListener( 'mousedown', _mousedown, false );\n\t\tthis.domElement.removeEventListener( 'mousemove', _mousemove, false );\n\t\tthis.domElement.removeEventListener( 'mouseup', _mouseup, false );\n\n\t\twindow.removeEventListener( 'keydown', _keydown, false );\n\t\twindow.removeEventListener( 'keyup', _keyup, false );\n\n\t};\n\n\tvar _mousemove = bind( this, this.mousemove );\n\tvar _mousedown = bind( this, this.mousedown );\n\tvar _mouseup = bind( this, this.mouseup );\n\tvar _keydown = bind( this, this.keydown );\n\tvar _keyup = bind( this, this.keyup );\n\n\tthis.domElement.addEventListener( 'contextmenu', contextmenu, false );\n\n\tthis.domElement.addEventListener( 'mousemove', _mousemove, false );\n\tthis.domElement.addEventListener( 'mousedown', _mousedown, false );\n\tthis.domElement.addEventListener( 'mouseup', _mouseup, false );\n\n\twindow.addEventListener( 'keydown', _keydown, false );\n\twindow.addEventListener( 'keyup', _keyup, false );\n\n\tthis.updateMovementVector();\n\tthis.updateRotationVector();\n\n};\n"]}