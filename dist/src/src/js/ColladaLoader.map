{"version":3,"sources":["src/src/js/ColladaLoader.js"],"names":["THREE","ColladaLoader","manager","Loader","call","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","path","LoaderUtils","extractUrlBase","loader","FileLoader","setPath","text","parse","options","convertUpAxis","value","console","warn","getElementsByTagName","xml","name","array","childNodes","i","l","length","child","nodeName","push","parseStrings","parts","trim","split","Array","parseFloats","parseFloat","parseInts","parseInt","parseId","substring","generateId","count","isEmpty","object","keys","parseAsset","unit","parseAssetUnit","upAxis","parseAssetUpAxis","undefined","hasAttribute","getAttribute","textContent","parseLibrary","libraryName","parser","library","elements","buildLibrary","data","builder","build","getBuild","parseAnimation","sources","samplers","channels","nodeType","id","parseSource","parseAnimationSampler","parseAnimationChannel","log","animations","inputs","semantic","target","shift","sid","arraySyntax","indexOf","memberSyntax","member","indices","replace","sampler","buildAnimation","tracks","hasOwnProperty","channel","inputId","INPUT","outputId","OUTPUT","inputSource","outputSource","animation","buildAnimationChannel","createKeyframeTracks","getAnimation","node","nodes","object3D","getNode","transform","transforms","defaultMatrix","matrix","clone","transpose","time","stride","il","j","jl","index","keyframes","prepareAnimationData","uuid","sort","ascending","transformAnimationData","a","b","position","Vector3","scale","quaternion","Quaternion","times","positionData","quaternionData","scaleData","keyframe","fromArray","decompose","x","y","z","w","VectorKeyframeTrack","QuaternionKeyframeTrack","property","defaultValue","empty","createMissingKeyframes","prev","next","getPrev","getNext","interpolate","key","parseAnimationClip","start","end","clips","buildAnimationClip","duration","animationTracks","AnimationClip","getAnimationClip","parseController","skin","parseSkin","controllers","bindShapeMatrix","joints","parseJoints","vertexWeights","parseVertexWeights","offset","vcount","v","buildController","geometry","geometries","buildSkin","skinIndices","skinWeights","weights","BONE_LIMIT","jointOffset","JOINT","weightOffset","WEIGHT","jointSource","inverseSource","INV_BIND_MATRIX","jointCount","vertexSkinData","skinIndex","weightId","skinWeight","weight","descending","d","bindMatrix","Matrix4","identity","boneInverse","getController","parseImage","init_from","images","buildImage","getImage","parseEffect","profile","parseEffectProfileCOMMON","effects","surfaces","parseEffectNewparam","technique","parseEffectTechnique","extra","parseEffectExtra","parseEffectSurface","parseEffectSampler","source","type","parameters","parseEffectParameters","parseEffectParameter","opaque","parseEffectParameterTexture","parseEffectParameterTextureExtra","parseEffectParameterTextureExtraTechnique","toUpperCase","parseEffectExtraTechnique","buildEffect","getEffect","parseMaterial","materials","getTextureLoader","image","extension","slice","lastIndexOf","toLowerCase","tgaLoader","textureLoader","buildMaterial","effect","material","MeshPhongMaterial","MeshLambertMaterial","MeshBasicMaterial","getTexture","textureObject","surface","texture","wrapS","wrapU","RepeatWrapping","ClampToEdgeWrapping","wrapT","wrapV","set","offsetU","offsetV","repeat","repeatU","repeatV","parameter","color","map","specular","specularMap","normalMap","lightMap","float","shininess","emissive","emissiveMap","transparent","transparency","opacity","double_sided","side","DoubleSide","getMaterial","parseCamera","optics","parseCameraOptics","cameras","parseCameraTechnique","parseCameraParameters","buildCamera","camera","PerspectiveCamera","yfov","aspect_ratio","znear","zfar","ymag","xmag","aspectRatio","OrthographicCamera","getCamera","parseLight","parseLightTechnique","lights","parseLightParameters","Color","falloffAngle","f","distance","Math","sqrt","buildLight","light","DirectionalLight","PointLight","SpotLight","AmbientLight","copy","getLight","parseGeometry","vertices","primitives","mesh","parseGeometryVertices","parseGeometryPrimitive","accessor","primitive","hasUV","inputname","max","p","groupPrimitives","checkUVCoordinates","uvsNeedsFix","buildGeometry","groupedPrimitives","primitiveType","buildGeometryType","normal","uv","uv2","BufferGeometry","materialKeys","g","vc","addGroup","input","prevLength","buildGeometryData","setAttribute","Float32BufferAttribute","pushVector","sourceStride","sourceArray","c","k","kl","getGeometry","parseKinematicsModel","links","parseKinematicsTechniqueCommon","kinematicsModels","buildKinematicsModel","getKinematicsModel","parseKinematicsJoint","parseKinematicsLink","parseKinematicsJointParameter","axis","limits","min","static","zeroPosition","middlePosition","attachments","parseKinematicsAttachment","parseKinematicsTransform","joint","pop","obj","angle","degToRad","parsePhysicsModel","rigidBodies","parsePhysicsRigidBody","physicsModels","parsePhysicsTechniqueCommon","inertia","mass","parseKinematicsScene","bindJointAxis","parseKinematicsBindJointAxis","kinematicsScenes","param","tmpJointIndex","jointIndex","substr","buildKinematicsScene","getKinematicsScene","setupKinematics","kinematicsModelId","kinematicsSceneId","visualSceneId","visualScenes","kinematicsModel","kinematicsScene","visualScene","getVisualScene","jointMap","targetElement","collada","querySelector","parentVisualElement","parentElement","connect","visualElement","visualElementName","traverse","buildTransformList","m0","kinematics","getJointValue","jointData","setJointValue","multiply","makeRotationAxis","makeTranslation","vector","prepareNodes","element","parseNode","instanceCameras","instanceControllers","instanceLights","instanceGeometries","instanceNodes","parseNodeInstance","hasNode","skeletons","instances","instance","symbol","buildSkeleton","boneData","sortedBoneData","skeleton","root","buildBoneHierarchy","hasVisualScene","children","error","bone","processed","bones","boneInverses","Skeleton","isBone","buildNode","objects","instanceCamera","controller","newObjects","buildObjects","isSkinnedMesh","bind","normalizeSkinWeights","instanceLight","Bone","Group","add","fallbackMaterial","resolveMaterialBinding","instanceMaterials","LineBasicMaterial","skinning","attributes","LineSegments","Line","SkinnedMesh","Mesh","parseVisualScene","buildVisualScene","group","parseScene","setupAnimations","parserErrorToText","parserError","result","stack","Node","TEXT_NODE","apply","scene","Scene","DOMParser","parseFromString","errorElement","errorText","version","asset","TextureLoader","resourcePath","setCrossOrigin","crossOrigin","TGALoader","setFromEuler","Euler","PI","multiplyScalar"],"mappings":"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","file":"ColladaLoader.map","sourceRoot":"..","sourcesContent":["/**\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nTHREE.ColladaLoader = function ( manager ) {\n\n\tTHREE.Loader.call( this, manager );\n\n};\n\nTHREE.ColladaLoader.prototype = Object.assign( Object.create( THREE.Loader.prototype ), {\n\n\tconstructor: THREE.ColladaLoader,\n\n\tload: function ( url, onLoad, onProgress, onError ) {\n\n\t\tvar scope = this;\n\n\t\tvar path = ( scope.path === '' ) ? THREE.LoaderUtils.extractUrlBase( url ) : scope.path;\n\n\t\tvar loader = new THREE.FileLoader( scope.manager );\n\t\tloader.setPath( scope.path );\n\t\tloader.load( url, function ( text ) {\n\n\t\t\tonLoad( scope.parse( text, path ) );\n\n\t\t}, onProgress, onError );\n\n\t},\n\n\toptions: {\n\n\t\tset convertUpAxis( value ) {\n\n\t\t\tconsole.warn( 'THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.' );\n\n\t\t}\n\n\t},\n\n\tparse: function ( text, path ) {\n\n\t\tfunction getElementsByTagName( xml, name ) {\n\n\t\t\t// Non recursive xml.getElementsByTagName() ...\n\n\t\t\tvar array = [];\n\t\t\tvar childNodes = xml.childNodes;\n\n\t\t\tfor ( var i = 0, l = childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = childNodes[ i ];\n\n\t\t\t\tif ( child.nodeName === name ) {\n\n\t\t\t\t\tarray.push( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseStrings( text ) {\n\n\t\t\tif ( text.length === 0 ) return [];\n\n\t\t\tvar parts = text.trim().split( /\\s+/ );\n\t\t\tvar array = new Array( parts.length );\n\n\t\t\tfor ( var i = 0, l = parts.length; i < l; i ++ ) {\n\n\t\t\t\tarray[ i ] = parts[ i ];\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseFloats( text ) {\n\n\t\t\tif ( text.length === 0 ) return [];\n\n\t\t\tvar parts = text.trim().split( /\\s+/ );\n\t\t\tvar array = new Array( parts.length );\n\n\t\t\tfor ( var i = 0, l = parts.length; i < l; i ++ ) {\n\n\t\t\t\tarray[ i ] = parseFloat( parts[ i ] );\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseInts( text ) {\n\n\t\t\tif ( text.length === 0 ) return [];\n\n\t\t\tvar parts = text.trim().split( /\\s+/ );\n\t\t\tvar array = new Array( parts.length );\n\n\t\t\tfor ( var i = 0, l = parts.length; i < l; i ++ ) {\n\n\t\t\t\tarray[ i ] = parseInt( parts[ i ] );\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseId( text ) {\n\n\t\t\treturn text.substring( 1 );\n\n\t\t}\n\n\t\tfunction generateId() {\n\n\t\t\treturn 'three_default_' + ( count ++ );\n\n\t\t}\n\n\t\tfunction isEmpty( object ) {\n\n\t\t\treturn Object.keys( object ).length === 0;\n\n\t\t}\n\n\t\t// asset\n\n\t\tfunction parseAsset( xml ) {\n\n\t\t\treturn {\n\t\t\t\tunit: parseAssetUnit( getElementsByTagName( xml, 'unit' )[ 0 ] ),\n\t\t\t\tupAxis: parseAssetUpAxis( getElementsByTagName( xml, 'up_axis' )[ 0 ] )\n\t\t\t};\n\n\t\t}\n\n\t\tfunction parseAssetUnit( xml ) {\n\n\t\t\tif ( ( xml !== undefined ) && ( xml.hasAttribute( 'meter' ) === true ) ) {\n\n\t\t\t\treturn parseFloat( xml.getAttribute( 'meter' ) );\n\n\t\t\t} else {\n\n\t\t\t\treturn 1; // default 1 meter\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseAssetUpAxis( xml ) {\n\n\t\t\treturn xml !== undefined ? xml.textContent : 'Y_UP';\n\n\t\t}\n\n\t\t// library\n\n\t\tfunction parseLibrary( xml, libraryName, nodeName, parser ) {\n\n\t\t\tvar library = getElementsByTagName( xml, libraryName )[ 0 ];\n\n\t\t\tif ( library !== undefined ) {\n\n\t\t\t\tvar elements = getElementsByTagName( library, nodeName );\n\n\t\t\t\tfor ( var i = 0; i < elements.length; i ++ ) {\n\n\t\t\t\t\tparser( elements[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildLibrary( data, builder ) {\n\n\t\t\tfor ( var name in data ) {\n\n\t\t\t\tvar object = data[ name ];\n\t\t\t\tobject.build = builder( data[ name ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// get\n\n\t\tfunction getBuild( data, builder ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\tdata.build = builder( data );\n\n\t\t\treturn data.build;\n\n\t\t}\n\n\t\t// animation\n\n\t\tfunction parseAnimation( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tsources: {},\n\t\t\t\tsamplers: {},\n\t\t\t\tchannels: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tvar id;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tid = child.getAttribute( 'id' );\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'sampler':\n\t\t\t\t\t\tid = child.getAttribute( 'id' );\n\t\t\t\t\t\tdata.samplers[ id ] = parseAnimationSampler( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'channel':\n\t\t\t\t\t\tid = child.getAttribute( 'target' );\n\t\t\t\t\t\tdata.channels[ id ] = parseAnimationChannel( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.log( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.animations[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseAnimationSampler( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tinputs: {},\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tdata.inputs[ semantic ] = id;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseAnimationChannel( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tvar target = xml.getAttribute( 'target' );\n\n\t\t\t// parsing SID Addressing Syntax\n\n\t\t\tvar parts = target.split( '/' );\n\n\t\t\tvar id = parts.shift();\n\t\t\tvar sid = parts.shift();\n\n\t\t\t// check selection syntax\n\n\t\t\tvar arraySyntax = ( sid.indexOf( '(' ) !== - 1 );\n\t\t\tvar memberSyntax = ( sid.indexOf( '.' ) !== - 1 );\n\n\t\t\tif ( memberSyntax ) {\n\n\t\t\t\t//  member selection access\n\n\t\t\t\tparts = sid.split( '.' );\n\t\t\t\tsid = parts.shift();\n\t\t\t\tdata.member = parts.shift();\n\n\t\t\t} else if ( arraySyntax ) {\n\n\t\t\t\t// array-access syntax. can be used to express fields in one-dimensional vectors or two-dimensional matrices.\n\n\t\t\t\tvar indices = sid.split( '(' );\n\t\t\t\tsid = indices.shift();\n\n\t\t\t\tfor ( var i = 0; i < indices.length; i ++ ) {\n\n\t\t\t\t\tindices[ i ] = parseInt( indices[ i ].replace( /\\)/, '' ) );\n\n\t\t\t\t}\n\n\t\t\t\tdata.indices = indices;\n\n\t\t\t}\n\n\t\t\tdata.id = id;\n\t\t\tdata.sid = sid;\n\n\t\t\tdata.arraySyntax = arraySyntax;\n\t\t\tdata.memberSyntax = memberSyntax;\n\n\t\t\tdata.sampler = parseId( xml.getAttribute( 'source' ) );\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildAnimation( data ) {\n\n\t\t\tvar tracks = [];\n\n\t\t\tvar channels = data.channels;\n\t\t\tvar samplers = data.samplers;\n\t\t\tvar sources = data.sources;\n\n\t\t\tfor ( var target in channels ) {\n\n\t\t\t\tif ( channels.hasOwnProperty( target ) ) {\n\n\t\t\t\t\tvar channel = channels[ target ];\n\t\t\t\t\tvar sampler = samplers[ channel.sampler ];\n\n\t\t\t\t\tvar inputId = sampler.inputs.INPUT;\n\t\t\t\t\tvar outputId = sampler.inputs.OUTPUT;\n\n\t\t\t\t\tvar inputSource = sources[ inputId ];\n\t\t\t\t\tvar outputSource = sources[ outputId ];\n\n\t\t\t\t\tvar animation = buildAnimationChannel( channel, inputSource, outputSource );\n\n\t\t\t\t\tcreateKeyframeTracks( animation, tracks );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn tracks;\n\n\t\t}\n\n\t\tfunction getAnimation( id ) {\n\n\t\t\treturn getBuild( library.animations[ id ], buildAnimation );\n\n\t\t}\n\n\t\tfunction buildAnimationChannel( channel, inputSource, outputSource ) {\n\n\t\t\tvar node = library.nodes[ channel.id ];\n\t\t\tvar object3D = getNode( node.id );\n\n\t\t\tvar transform = node.transforms[ channel.sid ];\n\t\t\tvar defaultMatrix = node.matrix.clone().transpose();\n\n\t\t\tvar time, stride;\n\t\t\tvar i, il, j, jl;\n\n\t\t\tvar data = {};\n\n\t\t\t// the collada spec allows the animation of data in various ways.\n\t\t\t// depending on the transform type (matrix, translate, rotate, scale), we execute different logic\n\n\t\t\tswitch ( transform ) {\n\n\t\t\t\tcase 'matrix':\n\n\t\t\t\t\tfor ( i = 0, il = inputSource.array.length; i < il; i ++ ) {\n\n\t\t\t\t\t\ttime = inputSource.array[ i ];\n\t\t\t\t\t\tstride = i * outputSource.stride;\n\n\t\t\t\t\t\tif ( data[ time ] === undefined ) data[ time ] = {};\n\n\t\t\t\t\t\tif ( channel.arraySyntax === true ) {\n\n\t\t\t\t\t\t\tvar value = outputSource.array[ stride ];\n\t\t\t\t\t\t\tvar index = channel.indices[ 0 ] + 4 * channel.indices[ 1 ];\n\n\t\t\t\t\t\t\tdata[ time ][ index ] = value;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tfor ( j = 0, jl = outputSource.stride; j < jl; j ++ ) {\n\n\t\t\t\t\t\t\t\tdata[ time ][ j ] = outputSource.array[ stride + j ];\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'translate':\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'rotate':\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'scale':\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tvar keyframes = prepareAnimationData( data, defaultMatrix );\n\n\t\t\tvar animation = {\n\t\t\t\tname: object3D.uuid,\n\t\t\t\tkeyframes: keyframes\n\t\t\t};\n\n\t\t\treturn animation;\n\n\t\t}\n\n\t\tfunction prepareAnimationData( data, defaultMatrix ) {\n\n\t\t\tvar keyframes = [];\n\n\t\t\t// transfer data into a sortable array\n\n\t\t\tfor ( var time in data ) {\n\n\t\t\t\tkeyframes.push( { time: parseFloat( time ), value: data[ time ] } );\n\n\t\t\t}\n\n\t\t\t// ensure keyframes are sorted by time\n\n\t\t\tkeyframes.sort( ascending );\n\n\t\t\t// now we clean up all animation data, so we can use them for keyframe tracks\n\n\t\t\tfor ( var i = 0; i < 16; i ++ ) {\n\n\t\t\t\ttransformAnimationData( keyframes, i, defaultMatrix.elements[ i ] );\n\n\t\t\t}\n\n\t\t\treturn keyframes;\n\n\t\t\t// array sort function\n\n\t\t\tfunction ascending( a, b ) {\n\n\t\t\t\treturn a.time - b.time;\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar position = new THREE.Vector3();\n\t\tvar scale = new THREE.Vector3();\n\t\tvar quaternion = new THREE.Quaternion();\n\n\t\tfunction createKeyframeTracks( animation, tracks ) {\n\n\t\t\tvar keyframes = animation.keyframes;\n\t\t\tvar name = animation.name;\n\n\t\t\tvar times = [];\n\t\t\tvar positionData = [];\n\t\t\tvar quaternionData = [];\n\t\t\tvar scaleData = [];\n\n\t\t\tfor ( var i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\tvar keyframe = keyframes[ i ];\n\n\t\t\t\tvar time = keyframe.time;\n\t\t\t\tvar value = keyframe.value;\n\n\t\t\t\tmatrix.fromArray( value ).transpose();\n\t\t\t\tmatrix.decompose( position, quaternion, scale );\n\n\t\t\t\ttimes.push( time );\n\t\t\t\tpositionData.push( position.x, position.y, position.z );\n\t\t\t\tquaternionData.push( quaternion.x, quaternion.y, quaternion.z, quaternion.w );\n\t\t\t\tscaleData.push( scale.x, scale.y, scale.z );\n\n\t\t\t}\n\n\t\t\tif ( positionData.length > 0 ) tracks.push( new THREE.VectorKeyframeTrack( name + '.position', times, positionData ) );\n\t\t\tif ( quaternionData.length > 0 ) tracks.push( new THREE.QuaternionKeyframeTrack( name + '.quaternion', times, quaternionData ) );\n\t\t\tif ( scaleData.length > 0 ) tracks.push( new THREE.VectorKeyframeTrack( name + '.scale', times, scaleData ) );\n\n\t\t\treturn tracks;\n\n\t\t}\n\n\t\tfunction transformAnimationData( keyframes, property, defaultValue ) {\n\n\t\t\tvar keyframe;\n\n\t\t\tvar empty = true;\n\t\t\tvar i, l;\n\n\t\t\t// check, if values of a property are missing in our keyframes\n\n\t\t\tfor ( i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\tkeyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] === undefined ) {\n\n\t\t\t\t\tkeyframe.value[ property ] = null; // mark as missing\n\n\t\t\t\t} else {\n\n\t\t\t\t\tempty = false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( empty === true ) {\n\n\t\t\t\t// no values at all, so we set a default value\n\n\t\t\t\tfor ( i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\t\tkeyframe = keyframes[ i ];\n\n\t\t\t\t\tkeyframe.value[ property ] = defaultValue;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// filling gaps\n\n\t\t\t\tcreateMissingKeyframes( keyframes, property );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction createMissingKeyframes( keyframes, property ) {\n\n\t\t\tvar prev, next;\n\n\t\t\tfor ( var i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\tvar keyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] === null ) {\n\n\t\t\t\t\tprev = getPrev( keyframes, i, property );\n\t\t\t\t\tnext = getNext( keyframes, i, property );\n\n\t\t\t\t\tif ( prev === null ) {\n\n\t\t\t\t\t\tkeyframe.value[ property ] = next.value[ property ];\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( next === null ) {\n\n\t\t\t\t\t\tkeyframe.value[ property ] = prev.value[ property ];\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tinterpolate( keyframe, prev, next, property );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getPrev( keyframes, i, property ) {\n\n\t\t\twhile ( i >= 0 ) {\n\n\t\t\t\tvar keyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] !== null ) return keyframe;\n\n\t\t\t\ti --;\n\n\t\t\t}\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfunction getNext( keyframes, i, property ) {\n\n\t\t\twhile ( i < keyframes.length ) {\n\n\t\t\t\tvar keyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] !== null ) return keyframe;\n\n\t\t\t\ti ++;\n\n\t\t\t}\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfunction interpolate( key, prev, next, property ) {\n\n\t\t\tif ( ( next.time - prev.time ) === 0 ) {\n\n\t\t\t\tkey.value[ property ] = prev.value[ property ];\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tkey.value[ property ] = ( ( key.time - prev.time ) * ( next.value[ property ] - prev.value[ property ] ) / ( next.time - prev.time ) ) + prev.value[ property ];\n\n\t\t}\n\n\t\t// animation clips\n\n\t\tfunction parseAnimationClip( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'id' ) || 'default',\n\t\t\t\tstart: parseFloat( xml.getAttribute( 'start' ) || 0 ),\n\t\t\t\tend: parseFloat( xml.getAttribute( 'end' ) || 0 ),\n\t\t\t\tanimations: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'instance_animation':\n\t\t\t\t\t\tdata.animations.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.clips[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildAnimationClip( data ) {\n\n\t\t\tvar tracks = [];\n\n\t\t\tvar name = data.name;\n\t\t\tvar duration = ( data.end - data.start ) || - 1;\n\t\t\tvar animations = data.animations;\n\n\t\t\tfor ( var i = 0, il = animations.length; i < il; i ++ ) {\n\n\t\t\t\tvar animationTracks = getAnimation( animations[ i ] );\n\n\t\t\t\tfor ( var j = 0, jl = animationTracks.length; j < jl; j ++ ) {\n\n\t\t\t\t\ttracks.push( animationTracks[ j ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new THREE.AnimationClip( name, duration, tracks );\n\n\t\t}\n\n\t\tfunction getAnimationClip( id ) {\n\n\t\t\treturn getBuild( library.clips[ id ], buildAnimationClip );\n\n\t\t}\n\n\t\t// controller\n\n\t\tfunction parseController( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'skin':\n\t\t\t\t\t\t// there is exactly one skin per controller\n\t\t\t\t\t\tdata.id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tdata.skin = parseSkin( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'morph':\n\t\t\t\t\t\tdata.id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Morph target animation not supported yet.' );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.controllers[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseSkin( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tsources: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'bind_shape_matrix':\n\t\t\t\t\t\tdata.bindShapeMatrix = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tvar id = child.getAttribute( 'id' );\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'joints':\n\t\t\t\t\t\tdata.joints = parseJoints( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vertex_weights':\n\t\t\t\t\t\tdata.vertexWeights = parseVertexWeights( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseJoints( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tinputs: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tdata.inputs[ semantic ] = id;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseVertexWeights( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tinputs: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tvar offset = parseInt( child.getAttribute( 'offset' ) );\n\t\t\t\t\t\tdata.inputs[ semantic ] = { id: id, offset: offset };\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vcount':\n\t\t\t\t\t\tdata.vcount = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'v':\n\t\t\t\t\t\tdata.v = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildController( data ) {\n\n\t\t\tvar build = {\n\t\t\t\tid: data.id\n\t\t\t};\n\n\t\t\tvar geometry = library.geometries[ build.id ];\n\n\t\t\tif ( data.skin !== undefined ) {\n\n\t\t\t\tbuild.skin = buildSkin( data.skin );\n\n\t\t\t\t// we enhance the 'sources' property of the corresponding geometry with our skin data\n\n\t\t\t\tgeometry.sources.skinIndices = build.skin.indices;\n\t\t\t\tgeometry.sources.skinWeights = build.skin.weights;\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction buildSkin( data ) {\n\n\t\t\tvar BONE_LIMIT = 4;\n\n\t\t\tvar build = {\n\t\t\t\tjoints: [], // this must be an array to preserve the joint order\n\t\t\t\tindices: {\n\t\t\t\t\tarray: [],\n\t\t\t\t\tstride: BONE_LIMIT\n\t\t\t\t},\n\t\t\t\tweights: {\n\t\t\t\t\tarray: [],\n\t\t\t\t\tstride: BONE_LIMIT\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar sources = data.sources;\n\t\t\tvar vertexWeights = data.vertexWeights;\n\n\t\t\tvar vcount = vertexWeights.vcount;\n\t\t\tvar v = vertexWeights.v;\n\t\t\tvar jointOffset = vertexWeights.inputs.JOINT.offset;\n\t\t\tvar weightOffset = vertexWeights.inputs.WEIGHT.offset;\n\n\t\t\tvar jointSource = data.sources[ data.joints.inputs.JOINT ];\n\t\t\tvar inverseSource = data.sources[ data.joints.inputs.INV_BIND_MATRIX ];\n\n\t\t\tvar weights = sources[ vertexWeights.inputs.WEIGHT.id ].array;\n\t\t\tvar stride = 0;\n\n\t\t\tvar i, j, l;\n\n\t\t\t// procces skin data for each vertex\n\n\t\t\tfor ( i = 0, l = vcount.length; i < l; i ++ ) {\n\n\t\t\t\tvar jointCount = vcount[ i ]; // this is the amount of joints that affect a single vertex\n\t\t\t\tvar vertexSkinData = [];\n\n\t\t\t\tfor ( j = 0; j < jointCount; j ++ ) {\n\n\t\t\t\t\tvar skinIndex = v[ stride + jointOffset ];\n\t\t\t\t\tvar weightId = v[ stride + weightOffset ];\n\t\t\t\t\tvar skinWeight = weights[ weightId ];\n\n\t\t\t\t\tvertexSkinData.push( { index: skinIndex, weight: skinWeight } );\n\n\t\t\t\t\tstride += 2;\n\n\t\t\t\t}\n\n\t\t\t\t// we sort the joints in descending order based on the weights.\n\t\t\t\t// this ensures, we only procced the most important joints of the vertex\n\n\t\t\t\tvertexSkinData.sort( descending );\n\n\t\t\t\t// now we provide for each vertex a set of four index and weight values.\n\t\t\t\t// the order of the skin data matches the order of vertices\n\n\t\t\t\tfor ( j = 0; j < BONE_LIMIT; j ++ ) {\n\n\t\t\t\t\tvar d = vertexSkinData[ j ];\n\n\t\t\t\t\tif ( d !== undefined ) {\n\n\t\t\t\t\t\tbuild.indices.array.push( d.index );\n\t\t\t\t\t\tbuild.weights.array.push( d.weight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tbuild.indices.array.push( 0 );\n\t\t\t\t\t\tbuild.weights.array.push( 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// setup bind matrix\n\n\t\t\tif ( data.bindShapeMatrix ) {\n\n\t\t\t\tbuild.bindMatrix = new THREE.Matrix4().fromArray( data.bindShapeMatrix ).transpose();\n\n\t\t\t} else {\n\n\t\t\t\tbuild.bindMatrix = new THREE.Matrix4().identity();\n\n\t\t\t}\n\n\t\t\t// process bones and inverse bind matrix data\n\n\t\t\tfor ( i = 0, l = jointSource.array.length; i < l; i ++ ) {\n\n\t\t\t\tvar name = jointSource.array[ i ];\n\t\t\t\tvar boneInverse = new THREE.Matrix4().fromArray( inverseSource.array, i * inverseSource.stride ).transpose();\n\n\t\t\t\tbuild.joints.push( { name: name, boneInverse: boneInverse } );\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t\t// array sort function\n\n\t\t\tfunction descending( a, b ) {\n\n\t\t\t\treturn b.weight - a.weight;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getController( id ) {\n\n\t\t\treturn getBuild( library.controllers[ id ], buildController );\n\n\t\t}\n\n\t\t// image\n\n\t\tfunction parseImage( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tinit_from: getElementsByTagName( xml, 'init_from' )[ 0 ].textContent\n\t\t\t};\n\n\t\t\tlibrary.images[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildImage( data ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\treturn data.init_from;\n\n\t\t}\n\n\t\tfunction getImage( id ) {\n\n\t\t\tvar data = library.images[ id ];\n\n\t\t\tif ( data !== undefined ) {\n\n\t\t\t\treturn getBuild( data, buildImage );\n\n\t\t\t}\n\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find image with ID:', id );\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// effect\n\n\t\tfunction parseEffect( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'profile_COMMON':\n\t\t\t\t\t\tdata.profile = parseEffectProfileCOMMON( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.effects[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseEffectProfileCOMMON( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tsurfaces: {},\n\t\t\t\tsamplers: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'newparam':\n\t\t\t\t\t\tparseEffectNewparam( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'technique':\n\t\t\t\t\t\tdata.technique = parseEffectTechnique( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'extra':\n\t\t\t\t\t\tdata.extra = parseEffectExtra( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectNewparam( xml, data ) {\n\n\t\t\tvar sid = xml.getAttribute( 'sid' );\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'surface':\n\t\t\t\t\t\tdata.surfaces[ sid ] = parseEffectSurface( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'sampler2D':\n\t\t\t\t\t\tdata.samplers[ sid ] = parseEffectSampler( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseEffectSurface( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'init_from':\n\t\t\t\t\t\tdata.init_from = child.textContent;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectSampler( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tdata.source = child.textContent;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectTechnique( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'constant':\n\t\t\t\t\tcase 'lambert':\n\t\t\t\t\tcase 'blinn':\n\t\t\t\t\tcase 'phong':\n\t\t\t\t\t\tdata.type = child.nodeName;\n\t\t\t\t\t\tdata.parameters = parseEffectParameters( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameters( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'emission':\n\t\t\t\t\tcase 'diffuse':\n\t\t\t\t\tcase 'specular':\n\t\t\t\t\tcase 'bump':\n\t\t\t\t\tcase 'ambient':\n\t\t\t\t\tcase 'shininess':\n\t\t\t\t\tcase 'transparency':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseEffectParameter( child );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'transparent':\n\t\t\t\t\t\tdata[ child.nodeName ] = {\n\t\t\t\t\t\t\topaque: child.getAttribute( 'opaque' ),\n\t\t\t\t\t\t\tdata: parseEffectParameter( child )\n\t\t\t\t\t\t};\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameter( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'color':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'float':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'texture':\n\t\t\t\t\t\tdata[ child.nodeName ] = { id: child.getAttribute( 'texture' ), extra: parseEffectParameterTexture( child ) };\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameterTexture( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\ttechnique: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'extra':\n\t\t\t\t\t\tparseEffectParameterTextureExtra( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameterTextureExtra( xml, data ) {\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique':\n\t\t\t\t\t\tparseEffectParameterTextureExtraTechnique( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseEffectParameterTextureExtraTechnique( xml, data ) {\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'repeatU':\n\t\t\t\t\tcase 'repeatV':\n\t\t\t\t\tcase 'offsetU':\n\t\t\t\t\tcase 'offsetV':\n\t\t\t\t\t\tdata.technique[ child.nodeName ] = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'wrapU':\n\t\t\t\t\tcase 'wrapV':\n\n\t\t\t\t\t\t// some files have values for wrapU/wrapV which become NaN via parseInt\n\n\t\t\t\t\t\tif ( child.textContent.toUpperCase() === 'TRUE' ) {\n\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = 1;\n\n\t\t\t\t\t\t} else if ( child.textContent.toUpperCase() === 'FALSE' ) {\n\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = 0;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = parseInt( child.textContent );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseEffectExtra( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique':\n\t\t\t\t\t\tdata.technique = parseEffectExtraTechnique( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectExtraTechnique( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'double_sided':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseInt( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildEffect( data ) {\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction getEffect( id ) {\n\n\t\t\treturn getBuild( library.effects[ id ], buildEffect );\n\n\t\t}\n\n\t\t// material\n\n\t\tfunction parseMaterial( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' )\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'instance_effect':\n\t\t\t\t\t\tdata.url = parseId( child.getAttribute( 'url' ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.materials[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction getTextureLoader( image ) {\n\n\t\t\tvar loader;\n\n\t\t\tvar extension = image.slice( ( image.lastIndexOf( '.' ) - 1 >>> 0 ) + 2 ); // http://www.jstips.co/en/javascript/get-file-extension/\n\t\t\textension = extension.toLowerCase();\n\n\t\t\tswitch ( extension ) {\n\n\t\t\t\tcase 'tga':\n\t\t\t\t\tloader = tgaLoader;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tloader = textureLoader;\n\n\t\t\t}\n\n\t\t\treturn loader;\n\n\t\t}\n\n\t\tfunction buildMaterial( data ) {\n\n\t\t\tvar effect = getEffect( data.url );\n\t\t\tvar technique = effect.profile.technique;\n\t\t\tvar extra = effect.profile.extra;\n\n\t\t\tvar material;\n\n\t\t\tswitch ( technique.type ) {\n\n\t\t\t\tcase 'phong':\n\t\t\t\tcase 'blinn':\n\t\t\t\t\tmaterial = new THREE.MeshPhongMaterial();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'lambert':\n\t\t\t\t\tmaterial = new THREE.MeshLambertMaterial();\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tmaterial = new THREE.MeshBasicMaterial();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tmaterial.name = data.name || '';\n\n\t\t\tfunction getTexture( textureObject ) {\n\n\t\t\t\tvar sampler = effect.profile.samplers[ textureObject.id ];\n\t\t\t\tvar image = null;\n\n\t\t\t\t// get image\n\n\t\t\t\tif ( sampler !== undefined ) {\n\n\t\t\t\t\tvar surface = effect.profile.surfaces[ sampler.source ];\n\t\t\t\t\timage = getImage( surface.init_from );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530).' );\n\t\t\t\t\timage = getImage( textureObject.id );\n\n\t\t\t\t}\n\n\t\t\t\t// create texture if image is avaiable\n\n\t\t\t\tif ( image !== null ) {\n\n\t\t\t\t\tvar loader = getTextureLoader( image );\n\n\t\t\t\t\tif ( loader !== undefined ) {\n\n\t\t\t\t\t\tvar texture = loader.load( image );\n\n\t\t\t\t\t\tvar extra = textureObject.extra;\n\n\t\t\t\t\t\tif ( extra !== undefined && extra.technique !== undefined && isEmpty( extra.technique ) === false ) {\n\n\t\t\t\t\t\t\tvar technique = extra.technique;\n\n\t\t\t\t\t\t\ttexture.wrapS = technique.wrapU ? THREE.RepeatWrapping : THREE.ClampToEdgeWrapping;\n\t\t\t\t\t\t\ttexture.wrapT = technique.wrapV ? THREE.RepeatWrapping : THREE.ClampToEdgeWrapping;\n\n\t\t\t\t\t\t\ttexture.offset.set( technique.offsetU || 0, technique.offsetV || 0 );\n\t\t\t\t\t\t\ttexture.repeat.set( technique.repeatU || 1, technique.repeatV || 1 );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\ttexture.wrapS = THREE.RepeatWrapping;\n\t\t\t\t\t\t\ttexture.wrapT = THREE.RepeatWrapping;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn texture;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Loader for texture %s not found.', image );\n\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t create texture with ID:', textureObject.id );\n\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tvar parameters = technique.parameters;\n\n\t\t\tfor ( var key in parameters ) {\n\n\t\t\t\tvar parameter = parameters[ key ];\n\n\t\t\t\tswitch ( key ) {\n\n\t\t\t\t\tcase 'diffuse':\n\t\t\t\t\t\tif ( parameter.color ) material.color.fromArray( parameter.color );\n\t\t\t\t\t\tif ( parameter.texture ) material.map = getTexture( parameter.texture );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'specular':\n\t\t\t\t\t\tif ( parameter.color && material.specular ) material.specular.fromArray( parameter.color );\n\t\t\t\t\t\tif ( parameter.texture ) material.specularMap = getTexture( parameter.texture );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'bump':\n\t\t\t\t\t\tif ( parameter.texture ) material.normalMap = getTexture( parameter.texture );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'ambient':\n\t\t\t\t\t\tif ( parameter.texture ) material.lightMap = getTexture( parameter.texture );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'shininess':\n\t\t\t\t\t\tif ( parameter.float && material.shininess ) material.shininess = parameter.float;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'emission':\n\t\t\t\t\t\tif ( parameter.color && material.emissive ) material.emissive.fromArray( parameter.color );\n\t\t\t\t\t\tif ( parameter.texture ) material.emissiveMap = getTexture( parameter.texture );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tvar transparent = parameters[ 'transparent' ];\n\t\t\tvar transparency = parameters[ 'transparency' ];\n\n\t\t\t// <transparency> does not exist but <transparent>\n\n\t\t\tif ( transparency === undefined && transparent ) {\n\n\t\t\t\ttransparency = {\n\t\t\t\t\tfloat: 1\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\t// <transparent> does not exist but <transparency>\n\n\t\t\tif ( transparent === undefined && transparency ) {\n\n\t\t\t\ttransparent = {\n\t\t\t\t\topaque: 'A_ONE',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcolor: [ 1, 1, 1, 1 ]\n\t\t\t\t\t} };\n\n\t\t\t}\n\n\t\t\tif ( transparent && transparency ) {\n\n\t\t\t\t// handle case if a texture exists but no color\n\n\t\t\t\tif ( transparent.data.texture ) {\n\n\t\t\t\t\t// we do not set an alpha map (see #13792)\n\n\t\t\t\t\tmaterial.transparent = true;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvar color = transparent.data.color;\n\n\t\t\t\t\tswitch ( transparent.opaque ) {\n\n\t\t\t\t\t\tcase 'A_ONE':\n\t\t\t\t\t\t\tmaterial.opacity = color[ 3 ] * transparency.float;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'RGB_ZERO':\n\t\t\t\t\t\t\tmaterial.opacity = 1 - ( color[ 0 ] * transparency.float );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'A_ZERO':\n\t\t\t\t\t\t\tmaterial.opacity = 1 - ( color[ 3 ] * transparency.float );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'RGB_ONE':\n\t\t\t\t\t\t\tmaterial.opacity = color[ 0 ] * transparency.float;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Invalid opaque type \"%s\" of transparent tag.', transparent.opaque );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( material.opacity < 1 ) material.transparent = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tif ( extra !== undefined && extra.technique !== undefined && extra.technique.double_sided === 1 ) {\n\n\t\t\t\tmaterial.side = THREE.DoubleSide;\n\n\t\t\t}\n\n\t\t\treturn material;\n\n\t\t}\n\n\t\tfunction getMaterial( id ) {\n\n\t\t\treturn getBuild( library.materials[ id ], buildMaterial );\n\n\t\t}\n\n\t\t// camera\n\n\t\tfunction parseCamera( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' )\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'optics':\n\t\t\t\t\t\tdata.optics = parseCameraOptics( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.cameras[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseCameraOptics( xml ) {\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\treturn parseCameraTechnique( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn {};\n\n\t\t}\n\n\t\tfunction parseCameraTechnique( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'perspective':\n\t\t\t\t\tcase 'orthographic':\n\n\t\t\t\t\t\tdata.technique = child.nodeName;\n\t\t\t\t\t\tdata.parameters = parseCameraParameters( child );\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseCameraParameters( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'xfov':\n\t\t\t\t\tcase 'yfov':\n\t\t\t\t\tcase 'xmag':\n\t\t\t\t\tcase 'ymag':\n\t\t\t\t\tcase 'znear':\n\t\t\t\t\tcase 'zfar':\n\t\t\t\t\tcase 'aspect_ratio':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildCamera( data ) {\n\n\t\t\tvar camera;\n\n\t\t\tswitch ( data.optics.technique ) {\n\n\t\t\t\tcase 'perspective':\n\t\t\t\t\tcamera = new THREE.PerspectiveCamera(\n\t\t\t\t\t\tdata.optics.parameters.yfov,\n\t\t\t\t\t\tdata.optics.parameters.aspect_ratio,\n\t\t\t\t\t\tdata.optics.parameters.znear,\n\t\t\t\t\t\tdata.optics.parameters.zfar\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'orthographic':\n\t\t\t\t\tvar ymag = data.optics.parameters.ymag;\n\t\t\t\t\tvar xmag = data.optics.parameters.xmag;\n\t\t\t\t\tvar aspectRatio = data.optics.parameters.aspect_ratio;\n\n\t\t\t\t\txmag = ( xmag === undefined ) ? ( ymag * aspectRatio ) : xmag;\n\t\t\t\t\tymag = ( ymag === undefined ) ? ( xmag / aspectRatio ) : ymag;\n\n\t\t\t\t\txmag *= 0.5;\n\t\t\t\t\tymag *= 0.5;\n\n\t\t\t\t\tcamera = new THREE.OrthographicCamera(\n\t\t\t\t\t\t- xmag, xmag, ymag, - ymag, // left, right, top, bottom\n\t\t\t\t\t\tdata.optics.parameters.znear,\n\t\t\t\t\t\tdata.optics.parameters.zfar\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tcamera = new THREE.PerspectiveCamera();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tcamera.name = data.name || '';\n\n\t\t\treturn camera;\n\n\t\t}\n\n\t\tfunction getCamera( id ) {\n\n\t\t\tvar data = library.cameras[ id ];\n\n\t\t\tif ( data !== undefined ) {\n\n\t\t\t\treturn getBuild( data, buildCamera );\n\n\t\t\t}\n\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find camera with ID:', id );\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// light\n\n\t\tfunction parseLight( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tdata = parseLightTechnique( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.lights[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseLightTechnique( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'directional':\n\t\t\t\t\tcase 'point':\n\t\t\t\t\tcase 'spot':\n\t\t\t\t\tcase 'ambient':\n\n\t\t\t\t\t\tdata.technique = child.nodeName;\n\t\t\t\t\t\tdata.parameters = parseLightParameters( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseLightParameters( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'color':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.color = new THREE.Color().fromArray( array );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'falloff_angle':\n\t\t\t\t\t\tdata.falloffAngle = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'quadratic_attenuation':\n\t\t\t\t\t\tvar f = parseFloat( child.textContent );\n\t\t\t\t\t\tdata.distance = f ? Math.sqrt( 1 / f ) : 0;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildLight( data ) {\n\n\t\t\tvar light;\n\n\t\t\tswitch ( data.technique ) {\n\n\t\t\t\tcase 'directional':\n\t\t\t\t\tlight = new THREE.DirectionalLight();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'point':\n\t\t\t\t\tlight = new THREE.PointLight();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'spot':\n\t\t\t\t\tlight = new THREE.SpotLight();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'ambient':\n\t\t\t\t\tlight = new THREE.AmbientLight();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( data.parameters.color ) light.color.copy( data.parameters.color );\n\t\t\tif ( data.parameters.distance ) light.distance = data.parameters.distance;\n\n\t\t\treturn light;\n\n\t\t}\n\n\t\tfunction getLight( id ) {\n\n\t\t\tvar data = library.lights[ id ];\n\n\t\t\tif ( data !== undefined ) {\n\n\t\t\t\treturn getBuild( data, buildLight );\n\n\t\t\t}\n\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find light with ID:', id );\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// geometry\n\n\t\tfunction parseGeometry( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' ),\n\t\t\t\tsources: {},\n\t\t\t\tvertices: {},\n\t\t\t\tprimitives: []\n\t\t\t};\n\n\t\t\tvar mesh = getElementsByTagName( xml, 'mesh' )[ 0 ];\n\n\t\t\t// the following tags inside geometry are not supported yet (see https://github.com/mrdoob/three.js/pull/12606): convex_mesh, spline, brep\n\t\t\tif ( mesh === undefined ) return;\n\n\t\t\tfor ( var i = 0; i < mesh.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = mesh.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tvar id = child.getAttribute( 'id' );\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vertices':\n\t\t\t\t\t\t// data.sources[ id ] = data.sources[ parseId( getElementsByTagName( child, 'input' )[ 0 ].getAttribute( 'source' ) ) ];\n\t\t\t\t\t\tdata.vertices = parseGeometryVertices( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'polygons':\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unsupported primitive type: ', child.nodeName );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'lines':\n\t\t\t\t\tcase 'linestrips':\n\t\t\t\t\tcase 'polylist':\n\t\t\t\t\tcase 'triangles':\n\t\t\t\t\t\tdata.primitives.push( parseGeometryPrimitive( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.log( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.geometries[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseSource( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tarray: [],\n\t\t\t\tstride: 3\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'float_array':\n\t\t\t\t\t\tdata.array = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'Name_array':\n\t\t\t\t\t\tdata.array = parseStrings( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tvar accessor = getElementsByTagName( child, 'accessor' )[ 0 ];\n\n\t\t\t\t\t\tif ( accessor !== undefined ) {\n\n\t\t\t\t\t\t\tdata.stride = parseInt( accessor.getAttribute( 'stride' ) );\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseGeometryVertices( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tdata[ child.getAttribute( 'semantic' ) ] = parseId( child.getAttribute( 'source' ) );\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseGeometryPrimitive( xml ) {\n\n\t\t\tvar primitive = {\n\t\t\t\ttype: xml.nodeName,\n\t\t\t\tmaterial: xml.getAttribute( 'material' ),\n\t\t\t\tcount: parseInt( xml.getAttribute( 'count' ) ),\n\t\t\t\tinputs: {},\n\t\t\t\tstride: 0,\n\t\t\t\thasUV: false\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tvar offset = parseInt( child.getAttribute( 'offset' ) );\n\t\t\t\t\t\tvar set = parseInt( child.getAttribute( 'set' ) );\n\t\t\t\t\t\tvar inputname = ( set > 0 ? semantic + set : semantic );\n\t\t\t\t\t\tprimitive.inputs[ inputname ] = { id: id, offset: offset };\n\t\t\t\t\t\tprimitive.stride = Math.max( primitive.stride, offset + 1 );\n\t\t\t\t\t\tif ( semantic === 'TEXCOORD' ) primitive.hasUV = true;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vcount':\n\t\t\t\t\t\tprimitive.vcount = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'p':\n\t\t\t\t\t\tprimitive.p = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn primitive;\n\n\t\t}\n\n\t\tfunction groupPrimitives( primitives ) {\n\n\t\t\tvar build = {};\n\n\t\t\tfor ( var i = 0; i < primitives.length; i ++ ) {\n\n\t\t\t\tvar primitive = primitives[ i ];\n\n\t\t\t\tif ( build[ primitive.type ] === undefined ) build[ primitive.type ] = [];\n\n\t\t\t\tbuild[ primitive.type ].push( primitive );\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction checkUVCoordinates( primitives ) {\n\n\t\t\tvar count = 0;\n\n\t\t\tfor ( var i = 0, l = primitives.length; i < l; i ++ ) {\n\n\t\t\t\tvar primitive = primitives[ i ];\n\n\t\t\t\tif ( primitive.hasUV === true ) {\n\n\t\t\t\t\tcount ++;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( count > 0 && count < primitives.length ) {\n\n\t\t\t\tprimitives.uvsNeedsFix = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildGeometry( data ) {\n\n\t\t\tvar build = {};\n\n\t\t\tvar sources = data.sources;\n\t\t\tvar vertices = data.vertices;\n\t\t\tvar primitives = data.primitives;\n\n\t\t\tif ( primitives.length === 0 ) return {};\n\n\t\t\t// our goal is to create one buffer geometry for a single type of primitives\n\t\t\t// first, we group all primitives by their type\n\n\t\t\tvar groupedPrimitives = groupPrimitives( primitives );\n\n\t\t\tfor ( var type in groupedPrimitives ) {\n\n\t\t\t\tvar primitiveType = groupedPrimitives[ type ];\n\n\t\t\t\t// second, ensure consistent uv coordinates for each type of primitives (polylist,triangles or lines)\n\n\t\t\t\tcheckUVCoordinates( primitiveType );\n\n\t\t\t\t// third, create a buffer geometry for each type of primitives\n\n\t\t\t\tbuild[ type ] = buildGeometryType( primitiveType, sources, vertices );\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction buildGeometryType( primitives, sources, vertices ) {\n\n\t\t\tvar build = {};\n\n\t\t\tvar position = { array: [], stride: 0 };\n\t\t\tvar normal = { array: [], stride: 0 };\n\t\t\tvar uv = { array: [], stride: 0 };\n\t\t\tvar uv2 = { array: [], stride: 0 };\n\t\t\tvar color = { array: [], stride: 0 };\n\n\t\t\tvar skinIndex = { array: [], stride: 4 };\n\t\t\tvar skinWeight = { array: [], stride: 4 };\n\n\t\t\tvar geometry = new THREE.BufferGeometry();\n\n\t\t\tvar materialKeys = [];\n\n\t\t\tvar start = 0;\n\n\t\t\tfor ( var p = 0; p < primitives.length; p ++ ) {\n\n\t\t\t\tvar primitive = primitives[ p ];\n\t\t\t\tvar inputs = primitive.inputs;\n\n\t\t\t\t// groups\n\n\t\t\t\tvar count = 0;\n\n\t\t\t\tswitch ( primitive.type ) {\n\n\t\t\t\t\tcase 'lines':\n\t\t\t\t\tcase 'linestrips':\n\t\t\t\t\t\tcount = primitive.count * 2;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'triangles':\n\t\t\t\t\t\tcount = primitive.count * 3;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'polylist':\n\n\t\t\t\t\t\tfor ( var g = 0; g < primitive.count; g ++ ) {\n\n\t\t\t\t\t\t\tvar vc = primitive.vcount[ g ];\n\n\t\t\t\t\t\t\tswitch ( vc ) {\n\n\t\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\t\tcount += 3; // single triangle\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\t\tcount += 6; // quad, subdivided into two triangles\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\tcount += ( vc - 2 ) * 3; // polylist with more than four vertices\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unknow primitive type:', primitive.type );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.addGroup( start, count, p );\n\t\t\t\tstart += count;\n\n\t\t\t\t// material\n\n\t\t\t\tif ( primitive.material ) {\n\n\t\t\t\t\tmaterialKeys.push( primitive.material );\n\n\t\t\t\t}\n\n\t\t\t\t// geometry data\n\n\t\t\t\tfor ( var name in inputs ) {\n\n\t\t\t\t\tvar input = inputs[ name ];\n\n\t\t\t\t\tswitch ( name )\t{\n\n\t\t\t\t\t\tcase 'VERTEX':\n\t\t\t\t\t\t\tfor ( var key in vertices ) {\n\n\t\t\t\t\t\t\t\tvar id = vertices[ key ];\n\n\t\t\t\t\t\t\t\tswitch ( key ) {\n\n\t\t\t\t\t\t\t\t\tcase 'POSITION':\n\t\t\t\t\t\t\t\t\t\tvar prevLength = position.array.length;\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, position.array );\n\t\t\t\t\t\t\t\t\t\tposition.stride = sources[ id ].stride;\n\n\t\t\t\t\t\t\t\t\t\tif ( sources.skinWeights && sources.skinIndices ) {\n\n\t\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources.skinIndices, input.offset, skinIndex.array );\n\t\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources.skinWeights, input.offset, skinWeight.array );\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// see #3803\n\n\t\t\t\t\t\t\t\t\t\tif ( primitive.hasUV === false && primitives.uvsNeedsFix === true ) {\n\n\t\t\t\t\t\t\t\t\t\t\tvar count = ( position.array.length - prevLength ) / position.stride;\n\n\t\t\t\t\t\t\t\t\t\t\tfor ( var i = 0; i < count; i ++ ) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t// fill missing uv coordinates\n\n\t\t\t\t\t\t\t\t\t\t\t\tuv.array.push( 0, 0 );\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'NORMAL':\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, normal.array );\n\t\t\t\t\t\t\t\t\t\tnormal.stride = sources[ id ].stride;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'COLOR':\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, color.array );\n\t\t\t\t\t\t\t\t\t\tcolor.stride = sources[ id ].stride;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'TEXCOORD':\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, uv.array );\n\t\t\t\t\t\t\t\t\t\tuv.stride = sources[ id ].stride;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'TEXCOORD1':\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, uv2.array );\n\t\t\t\t\t\t\t\t\t\tuv.stride = sources[ id ].stride;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Semantic \"%s\" not handled in geometry build process.', key );\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'NORMAL':\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, normal.array );\n\t\t\t\t\t\t\tnormal.stride = sources[ input.id ].stride;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'COLOR':\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, color.array );\n\t\t\t\t\t\t\tcolor.stride = sources[ input.id ].stride;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'TEXCOORD':\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, uv.array );\n\t\t\t\t\t\t\tuv.stride = sources[ input.id ].stride;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'TEXCOORD1':\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, uv2.array );\n\t\t\t\t\t\t\tuv2.stride = sources[ input.id ].stride;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// build geometry\n\n\t\t\tif ( position.array.length > 0 ) geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( position.array, position.stride ) );\n\t\t\tif ( normal.array.length > 0 ) geometry.setAttribute( 'normal', new THREE.Float32BufferAttribute( normal.array, normal.stride ) );\n\t\t\tif ( color.array.length > 0 ) geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( color.array, color.stride ) );\n\t\t\tif ( uv.array.length > 0 ) geometry.setAttribute( 'uv', new THREE.Float32BufferAttribute( uv.array, uv.stride ) );\n\t\t\tif ( uv2.array.length > 0 ) geometry.setAttribute( 'uv2', new THREE.Float32BufferAttribute( uv2.array, uv2.stride ) );\n\n\t\t\tif ( skinIndex.array.length > 0 ) geometry.setAttribute( 'skinIndex', new THREE.Float32BufferAttribute( skinIndex.array, skinIndex.stride ) );\n\t\t\tif ( skinWeight.array.length > 0 ) geometry.setAttribute( 'skinWeight', new THREE.Float32BufferAttribute( skinWeight.array, skinWeight.stride ) );\n\n\t\t\tbuild.data = geometry;\n\t\t\tbuild.type = primitives[ 0 ].type;\n\t\t\tbuild.materialKeys = materialKeys;\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction buildGeometryData( primitive, source, offset, array ) {\n\n\t\t\tvar indices = primitive.p;\n\t\t\tvar stride = primitive.stride;\n\t\t\tvar vcount = primitive.vcount;\n\n\t\t\tfunction pushVector( i ) {\n\n\t\t\t\tvar index = indices[ i + offset ] * sourceStride;\n\t\t\t\tvar length = index + sourceStride;\n\n\t\t\t\tfor ( ; index < length; index ++ ) {\n\n\t\t\t\t\tarray.push( sourceArray[ index ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tvar sourceArray = source.array;\n\t\t\tvar sourceStride = source.stride;\n\n\t\t\tif ( primitive.vcount !== undefined ) {\n\n\t\t\t\tvar index = 0;\n\n\t\t\t\tfor ( var i = 0, l = vcount.length; i < l; i ++ ) {\n\n\t\t\t\t\tvar count = vcount[ i ];\n\n\t\t\t\t\tif ( count === 4 ) {\n\n\t\t\t\t\t\tvar a = index + stride * 0;\n\t\t\t\t\t\tvar b = index + stride * 1;\n\t\t\t\t\t\tvar c = index + stride * 2;\n\t\t\t\t\t\tvar d = index + stride * 3;\n\n\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( d );\n\t\t\t\t\t\tpushVector( b ); pushVector( c ); pushVector( d );\n\n\t\t\t\t\t} else if ( count === 3 ) {\n\n\t\t\t\t\t\tvar a = index + stride * 0;\n\t\t\t\t\t\tvar b = index + stride * 1;\n\t\t\t\t\t\tvar c = index + stride * 2;\n\n\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( c );\n\n\t\t\t\t\t} else if ( count > 4 ) {\n\n\t\t\t\t\t\tfor ( var k = 1, kl = ( count - 2 ); k <= kl; k ++ ) {\n\n\t\t\t\t\t\t\tvar a = index + stride * 0;\n\t\t\t\t\t\t\tvar b = index + stride * k;\n\t\t\t\t\t\t\tvar c = index + stride * ( k + 1 );\n\n\t\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( c );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tindex += stride * count;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfor ( var i = 0, l = indices.length; i < l; i += stride ) {\n\n\t\t\t\t\tpushVector( i );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getGeometry( id ) {\n\n\t\t\treturn getBuild( library.geometries[ id ], buildGeometry );\n\n\t\t}\n\n\t\t// kinematics\n\n\t\tfunction parseKinematicsModel( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\tjoints: {},\n\t\t\t\tlinks: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tparseKinematicsTechniqueCommon( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.kinematicsModels[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildKinematicsModel( data ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction getKinematicsModel( id ) {\n\n\t\t\treturn getBuild( library.kinematicsModels[ id ], buildKinematicsModel );\n\n\t\t}\n\n\t\tfunction parseKinematicsTechniqueCommon( xml, data ) {\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'joint':\n\t\t\t\t\t\tdata.joints[ child.getAttribute( 'sid' ) ] = parseKinematicsJoint( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'link':\n\t\t\t\t\t\tdata.links.push( parseKinematicsLink( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseKinematicsJoint( xml ) {\n\n\t\t\tvar data;\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'prismatic':\n\t\t\t\t\tcase 'revolute':\n\t\t\t\t\t\tdata = parseKinematicsJointParameter( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsJointParameter( xml, data ) {\n\n\t\t\tvar data = {\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\taxis: new THREE.Vector3(),\n\t\t\t\tlimits: {\n\t\t\t\t\tmin: 0,\n\t\t\t\t\tmax: 0\n\t\t\t\t},\n\t\t\t\ttype: xml.nodeName,\n\t\t\t\tstatic: false,\n\t\t\t\tzeroPosition: 0,\n\t\t\t\tmiddlePosition: 0\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'axis':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.axis.fromArray( array );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'limits':\n\t\t\t\t\t\tvar max = child.getElementsByTagName( 'max' )[ 0 ];\n\t\t\t\t\t\tvar min = child.getElementsByTagName( 'min' )[ 0 ];\n\n\t\t\t\t\t\tdata.limits.max = parseFloat( max.textContent );\n\t\t\t\t\t\tdata.limits.min = parseFloat( min.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// if min is equal to or greater than max, consider the joint static\n\n\t\t\tif ( data.limits.min >= data.limits.max ) {\n\n\t\t\t\tdata.static = true;\n\n\t\t\t}\n\n\t\t\t// calculate middle position\n\n\t\t\tdata.middlePosition = ( data.limits.min + data.limits.max ) / 2.0;\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsLink( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\tattachments: [],\n\t\t\t\ttransforms: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'attachment_full':\n\t\t\t\t\t\tdata.attachments.push( parseKinematicsAttachment( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tdata.transforms.push( parseKinematicsTransform( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsAttachment( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tjoint: xml.getAttribute( 'joint' ).split( '/' ).pop(),\n\t\t\t\ttransforms: [],\n\t\t\t\tlinks: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'link':\n\t\t\t\t\t\tdata.links.push( parseKinematicsLink( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tdata.transforms.push( parseKinematicsTransform( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsTransform( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\ttype: xml.nodeName\n\t\t\t};\n\n\t\t\tvar array = parseFloats( xml.textContent );\n\n\t\t\tswitch ( data.type ) {\n\n\t\t\t\tcase 'matrix':\n\t\t\t\t\tdata.obj = new THREE.Matrix4();\n\t\t\t\t\tdata.obj.fromArray( array ).transpose();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'translate':\n\t\t\t\t\tdata.obj = new THREE.Vector3();\n\t\t\t\t\tdata.obj.fromArray( array );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'rotate':\n\t\t\t\t\tdata.obj = new THREE.Vector3();\n\t\t\t\t\tdata.obj.fromArray( array );\n\t\t\t\t\tdata.angle = THREE.Math.degToRad( array[ 3 ] );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\t// physics\n\n\t\tfunction parsePhysicsModel( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\trigidBodies: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'rigid_body':\n\t\t\t\t\t\tdata.rigidBodies[ child.getAttribute( 'name' ) ] = {};\n\t\t\t\t\t\tparsePhysicsRigidBody( child, data.rigidBodies[ child.getAttribute( 'name' ) ] );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.physicsModels[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parsePhysicsRigidBody( xml, data ) {\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tparsePhysicsTechniqueCommon( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parsePhysicsTechniqueCommon( xml, data ) {\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'inertia':\n\t\t\t\t\t\tdata.inertia = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'mass':\n\t\t\t\t\t\tdata.mass = parseFloats( child.textContent )[ 0 ];\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// scene\n\n\t\tfunction parseKinematicsScene( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tbindJointAxis: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'bind_joint_axis':\n\t\t\t\t\t\tdata.bindJointAxis.push( parseKinematicsBindJointAxis( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.kinematicsScenes[ parseId( xml.getAttribute( 'url' ) ) ] = data;\n\n\t\t}\n\n\t\tfunction parseKinematicsBindJointAxis( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\ttarget: xml.getAttribute( 'target' ).split( '/' ).pop()\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'axis':\n\t\t\t\t\t\tvar param = child.getElementsByTagName( 'param' )[ 0 ];\n\t\t\t\t\t\tdata.axis = param.textContent;\n\t\t\t\t\t\tvar tmpJointIndex = data.axis.split( 'inst_' ).pop().split( 'axis' )[ 0 ];\n\t\t\t\t\t\tdata.jointIndex = tmpJointIndex.substr( 0, tmpJointIndex.length - 1 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildKinematicsScene( data ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction getKinematicsScene( id ) {\n\n\t\t\treturn getBuild( library.kinematicsScenes[ id ], buildKinematicsScene );\n\n\t\t}\n\n\t\tfunction setupKinematics() {\n\n\t\t\tvar kinematicsModelId = Object.keys( library.kinematicsModels )[ 0 ];\n\t\t\tvar kinematicsSceneId = Object.keys( library.kinematicsScenes )[ 0 ];\n\t\t\tvar visualSceneId = Object.keys( library.visualScenes )[ 0 ];\n\n\t\t\tif ( kinematicsModelId === undefined || kinematicsSceneId === undefined ) return;\n\n\t\t\tvar kinematicsModel = getKinematicsModel( kinematicsModelId );\n\t\t\tvar kinematicsScene = getKinematicsScene( kinematicsSceneId );\n\t\t\tvar visualScene = getVisualScene( visualSceneId );\n\n\t\t\tvar bindJointAxis = kinematicsScene.bindJointAxis;\n\t\t\tvar jointMap = {};\n\n\t\t\tfor ( var i = 0, l = bindJointAxis.length; i < l; i ++ ) {\n\n\t\t\t\tvar axis = bindJointAxis[ i ];\n\n\t\t\t\t// the result of the following query is an element of type 'translate', 'rotate','scale' or 'matrix'\n\n\t\t\t\tvar targetElement = collada.querySelector( '[sid=\"' + axis.target + '\"]' );\n\n\t\t\t\tif ( targetElement ) {\n\n\t\t\t\t\t// get the parent of the transfrom element\n\n\t\t\t\t\tvar parentVisualElement = targetElement.parentElement;\n\n\t\t\t\t\t// connect the joint of the kinematics model with the element in the visual scene\n\n\t\t\t\t\tconnect( axis.jointIndex, parentVisualElement );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfunction connect( jointIndex, visualElement ) {\n\n\t\t\t\tvar visualElementName = visualElement.getAttribute( 'name' );\n\t\t\t\tvar joint = kinematicsModel.joints[ jointIndex ];\n\n\t\t\t\tvisualScene.traverse( function ( object ) {\n\n\t\t\t\t\tif ( object.name === visualElementName ) {\n\n\t\t\t\t\t\tjointMap[ jointIndex ] = {\n\t\t\t\t\t\t\tobject: object,\n\t\t\t\t\t\t\ttransforms: buildTransformList( visualElement ),\n\t\t\t\t\t\t\tjoint: joint,\n\t\t\t\t\t\t\tposition: joint.zeroPosition\n\t\t\t\t\t\t};\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tvar m0 = new THREE.Matrix4();\n\n\t\t\tkinematics = {\n\n\t\t\t\tjoints: kinematicsModel && kinematicsModel.joints,\n\n\t\t\t\tgetJointValue: function ( jointIndex ) {\n\n\t\t\t\t\tvar jointData = jointMap[ jointIndex ];\n\n\t\t\t\t\tif ( jointData ) {\n\n\t\t\t\t\t\treturn jointData.position;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' doesn\\'t exist.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t},\n\n\t\t\t\tsetJointValue: function ( jointIndex, value ) {\n\n\t\t\t\t\tvar jointData = jointMap[ jointIndex ];\n\n\t\t\t\t\tif ( jointData ) {\n\n\t\t\t\t\t\tvar joint = jointData.joint;\n\n\t\t\t\t\t\tif ( value > joint.limits.max || value < joint.limits.min ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' value ' + value + ' outside of limits (min: ' + joint.limits.min + ', max: ' + joint.limits.max + ').' );\n\n\t\t\t\t\t\t} else if ( joint.static ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' is static.' );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tvar object = jointData.object;\n\t\t\t\t\t\t\tvar axis = joint.axis;\n\t\t\t\t\t\t\tvar transforms = jointData.transforms;\n\n\t\t\t\t\t\t\tmatrix.identity();\n\n\t\t\t\t\t\t\t// each update, we have to apply all transforms in the correct order\n\n\t\t\t\t\t\t\tfor ( var i = 0; i < transforms.length; i ++ ) {\n\n\t\t\t\t\t\t\t\tvar transform = transforms[ i ];\n\n\t\t\t\t\t\t\t\t// if there is a connection of the transform node with a joint, apply the joint value\n\n\t\t\t\t\t\t\t\tif ( transform.sid && transform.sid.indexOf( jointIndex ) !== - 1 ) {\n\n\t\t\t\t\t\t\t\t\tswitch ( joint.type ) {\n\n\t\t\t\t\t\t\t\t\t\tcase 'revolute':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeRotationAxis( axis, THREE.Math.degToRad( value ) ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'prismatic':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeTranslation( axis.x * value, axis.y * value, axis.z * value ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unknown joint type: ' + joint.type );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\tswitch ( transform.type ) {\n\n\t\t\t\t\t\t\t\t\t\tcase 'matrix':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( transform.obj );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'translate':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeTranslation( transform.obj.x, transform.obj.y, transform.obj.z ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'scale':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.scale( transform.obj );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeRotationAxis( transform.obj, transform.angle ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tobject.matrix.copy( matrix );\n\t\t\t\t\t\t\tobject.matrix.decompose( object.position, object.quaternion, object.scale );\n\n\t\t\t\t\t\t\tjointMap[ jointIndex ].position = value;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.log( 'THREE.ColladaLoader: ' + jointIndex + ' does not exist.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}\n\n\t\tfunction buildTransformList( node ) {\n\n\t\t\tvar transforms = [];\n\n\t\t\tvar xml = collada.querySelector( '[id=\"' + node.id + '\"]' );\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tvar matrix = new THREE.Matrix4().fromArray( array ).transpose();\n\t\t\t\t\t\ttransforms.push( {\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\n\t\t\t\t\t\t\ttype: child.nodeName,\n\t\t\t\t\t\t\tobj: matrix\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\tcase 'scale':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tvar vector = new THREE.Vector3().fromArray( array );\n\t\t\t\t\t\ttransforms.push( {\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\n\t\t\t\t\t\t\ttype: child.nodeName,\n\t\t\t\t\t\t\tobj: vector\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tvar vector = new THREE.Vector3().fromArray( array );\n\t\t\t\t\t\tvar angle = THREE.Math.degToRad( array[ 3 ] );\n\t\t\t\t\t\ttransforms.push( {\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\n\t\t\t\t\t\t\ttype: child.nodeName,\n\t\t\t\t\t\t\tobj: vector,\n\t\t\t\t\t\t\tangle: angle\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn transforms;\n\n\t\t}\n\n\t\t// nodes\n\n\t\tfunction prepareNodes( xml ) {\n\n\t\t\tvar elements = xml.getElementsByTagName( 'node' );\n\n\t\t\t// ensure all node elements have id attributes\n\n\t\t\tfor ( var i = 0; i < elements.length; i ++ ) {\n\n\t\t\t\tvar element = elements[ i ];\n\n\t\t\t\tif ( element.hasAttribute( 'id' ) === false ) {\n\n\t\t\t\t\telement.setAttribute( 'id', generateId() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar matrix = new THREE.Matrix4();\n\t\tvar vector = new THREE.Vector3();\n\n\t\tfunction parseNode( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\ttype: xml.getAttribute( 'type' ),\n\t\t\t\tid: xml.getAttribute( 'id' ),\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\n\t\t\t\tmatrix: new THREE.Matrix4(),\n\t\t\t\tnodes: [],\n\t\t\t\tinstanceCameras: [],\n\t\t\t\tinstanceControllers: [],\n\t\t\t\tinstanceLights: [],\n\t\t\t\tinstanceGeometries: [],\n\t\t\t\tinstanceNodes: [],\n\t\t\t\ttransforms: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'node':\n\t\t\t\t\t\tdata.nodes.push( child.getAttribute( 'id' ) );\n\t\t\t\t\t\tparseNode( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_camera':\n\t\t\t\t\t\tdata.instanceCameras.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_controller':\n\t\t\t\t\t\tdata.instanceControllers.push( parseNodeInstance( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_light':\n\t\t\t\t\t\tdata.instanceLights.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_geometry':\n\t\t\t\t\t\tdata.instanceGeometries.push( parseNodeInstance( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_node':\n\t\t\t\t\t\tdata.instanceNodes.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.matrix.multiply( matrix.fromArray( array ).transpose() );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tvector.fromArray( array );\n\t\t\t\t\t\tdata.matrix.multiply( matrix.makeTranslation( vector.x, vector.y, vector.z ) );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tvar angle = THREE.Math.degToRad( array[ 3 ] );\n\t\t\t\t\t\tdata.matrix.multiply( matrix.makeRotationAxis( vector.fromArray( array ), angle ) );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'scale':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.matrix.scale( vector.fromArray( array ) );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'extra':\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.log( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( hasNode( data.id ) ) {\n\n\t\t\t\tconsole.warn( 'THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.', data.id );\n\n\t\t\t} else {\n\n\t\t\t\tlibrary.nodes[ data.id ] = data;\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseNodeInstance( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tid: parseId( xml.getAttribute( 'url' ) ),\n\t\t\t\tmaterials: {},\n\t\t\t\tskeletons: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'bind_material':\n\t\t\t\t\t\tvar instances = child.getElementsByTagName( 'instance_material' );\n\n\t\t\t\t\t\tfor ( var j = 0; j < instances.length; j ++ ) {\n\n\t\t\t\t\t\t\tvar instance = instances[ j ];\n\t\t\t\t\t\t\tvar symbol = instance.getAttribute( 'symbol' );\n\t\t\t\t\t\t\tvar target = instance.getAttribute( 'target' );\n\n\t\t\t\t\t\t\tdata.materials[ symbol ] = parseId( target );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'skeleton':\n\t\t\t\t\t\tdata.skeletons.push( parseId( child.textContent ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildSkeleton( skeletons, joints ) {\n\n\t\t\tvar boneData = [];\n\t\t\tvar sortedBoneData = [];\n\n\t\t\tvar i, j, data;\n\n\t\t\t// a skeleton can have multiple root bones. collada expresses this\n\t\t\t// situtation with multiple \"skeleton\" tags per controller instance\n\n\t\t\tfor ( i = 0; i < skeletons.length; i ++ ) {\n\n\t\t\t\tvar skeleton = skeletons[ i ];\n\n\t\t\t\tvar root;\n\n\t\t\t\tif ( hasNode( skeleton ) ) {\n\n\t\t\t\t\troot = getNode( skeleton );\n\t\t\t\t\tbuildBoneHierarchy( root, joints, boneData );\n\n\t\t\t\t} else if ( hasVisualScene( skeleton ) ) {\n\n\t\t\t\t\t// handle case where the skeleton refers to the visual scene (#13335)\n\n\t\t\t\t\tvar visualScene = library.visualScenes[ skeleton ];\n\t\t\t\t\tvar children = visualScene.children;\n\n\t\t\t\t\tfor ( var j = 0; j < children.length; j ++ ) {\n\n\t\t\t\t\t\tvar child = children[ j ];\n\n\t\t\t\t\t\tif ( child.type === 'JOINT' ) {\n\n\t\t\t\t\t\t\tvar root = getNode( child.id );\n\t\t\t\t\t\t\tbuildBoneHierarchy( root, joints, boneData );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( 'THREE.ColladaLoader: Unable to find root bone of skeleton with ID:', skeleton );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// sort bone data (the order is defined in the corresponding controller)\n\n\t\t\tfor ( i = 0; i < joints.length; i ++ ) {\n\n\t\t\t\tfor ( j = 0; j < boneData.length; j ++ ) {\n\n\t\t\t\t\tdata = boneData[ j ];\n\n\t\t\t\t\tif ( data.bone.name === joints[ i ].name ) {\n\n\t\t\t\t\t\tsortedBoneData[ i ] = data;\n\t\t\t\t\t\tdata.processed = true;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// add unprocessed bone data at the end of the list\n\n\t\t\tfor ( i = 0; i < boneData.length; i ++ ) {\n\n\t\t\t\tdata = boneData[ i ];\n\n\t\t\t\tif ( data.processed === false ) {\n\n\t\t\t\t\tsortedBoneData.push( data );\n\t\t\t\t\tdata.processed = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// setup arrays for skeleton creation\n\n\t\t\tvar bones = [];\n\t\t\tvar boneInverses = [];\n\n\t\t\tfor ( i = 0; i < sortedBoneData.length; i ++ ) {\n\n\t\t\t\tdata = sortedBoneData[ i ];\n\n\t\t\t\tbones.push( data.bone );\n\t\t\t\tboneInverses.push( data.boneInverse );\n\n\t\t\t}\n\n\t\t\treturn new THREE.Skeleton( bones, boneInverses );\n\n\t\t}\n\n\t\tfunction buildBoneHierarchy( root, joints, boneData ) {\n\n\t\t\t// setup bone data from visual scene\n\n\t\t\troot.traverse( function ( object ) {\n\n\t\t\t\tif ( object.isBone === true ) {\n\n\t\t\t\t\tvar boneInverse;\n\n\t\t\t\t\t// retrieve the boneInverse from the controller data\n\n\t\t\t\t\tfor ( var i = 0; i < joints.length; i ++ ) {\n\n\t\t\t\t\t\tvar joint = joints[ i ];\n\n\t\t\t\t\t\tif ( joint.name === object.name ) {\n\n\t\t\t\t\t\t\tboneInverse = joint.boneInverse;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( boneInverse === undefined ) {\n\n\t\t\t\t\t\t// Unfortunately, there can be joints in the visual scene that are not part of the\n\t\t\t\t\t\t// corresponding controller. In this case, we have to create a dummy boneInverse matrix\n\t\t\t\t\t\t// for the respective bone. This bone won't affect any vertices, because there are no skin indices\n\t\t\t\t\t\t// and weights defined for it. But we still have to add the bone to the sorted bone list in order to\n\t\t\t\t\t\t// ensure a correct animation of the model.\n\n\t\t\t\t\t\tboneInverse = new THREE.Matrix4();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tboneData.push( { bone: object, boneInverse: boneInverse, processed: false } );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t\tfunction buildNode( data ) {\n\n\t\t\tvar objects = [];\n\n\t\t\tvar matrix = data.matrix;\n\t\t\tvar nodes = data.nodes;\n\t\t\tvar type = data.type;\n\t\t\tvar instanceCameras = data.instanceCameras;\n\t\t\tvar instanceControllers = data.instanceControllers;\n\t\t\tvar instanceLights = data.instanceLights;\n\t\t\tvar instanceGeometries = data.instanceGeometries;\n\t\t\tvar instanceNodes = data.instanceNodes;\n\n\t\t\t// nodes\n\n\t\t\tfor ( var i = 0, l = nodes.length; i < l; i ++ ) {\n\n\t\t\t\tobjects.push( getNode( nodes[ i ] ) );\n\n\t\t\t}\n\n\t\t\t// instance cameras\n\n\t\t\tfor ( var i = 0, l = instanceCameras.length; i < l; i ++ ) {\n\n\t\t\t\tvar instanceCamera = getCamera( instanceCameras[ i ] );\n\n\t\t\t\tif ( instanceCamera !== null ) {\n\n\t\t\t\t\tobjects.push( instanceCamera.clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance controllers\n\n\t\t\tfor ( var i = 0, l = instanceControllers.length; i < l; i ++ ) {\n\n\t\t\t\tvar instance = instanceControllers[ i ];\n\t\t\t\tvar controller = getController( instance.id );\n\t\t\t\tvar geometries = getGeometry( controller.id );\n\t\t\t\tvar newObjects = buildObjects( geometries, instance.materials );\n\n\t\t\t\tvar skeletons = instance.skeletons;\n\t\t\t\tvar joints = controller.skin.joints;\n\n\t\t\t\tvar skeleton = buildSkeleton( skeletons, joints );\n\n\t\t\t\tfor ( var j = 0, jl = newObjects.length; j < jl; j ++ ) {\n\n\t\t\t\t\tvar object = newObjects[ j ];\n\n\t\t\t\t\tif ( object.isSkinnedMesh ) {\n\n\t\t\t\t\t\tobject.bind( skeleton, controller.skin.bindMatrix );\n\t\t\t\t\t\tobject.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tobjects.push( object );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance lights\n\n\t\t\tfor ( var i = 0, l = instanceLights.length; i < l; i ++ ) {\n\n\t\t\t\tvar instanceLight = getLight( instanceLights[ i ] );\n\n\t\t\t\tif ( instanceLight !== null ) {\n\n\t\t\t\t\tobjects.push( instanceLight.clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance geometries\n\n\t\t\tfor ( var i = 0, l = instanceGeometries.length; i < l; i ++ ) {\n\n\t\t\t\tvar instance = instanceGeometries[ i ];\n\n\t\t\t\t// a single geometry instance in collada can lead to multiple object3Ds.\n\t\t\t\t// this is the case when primitives are combined like triangles and lines\n\n\t\t\t\tvar geometries = getGeometry( instance.id );\n\t\t\t\tvar newObjects = buildObjects( geometries, instance.materials );\n\n\t\t\t\tfor ( var j = 0, jl = newObjects.length; j < jl; j ++ ) {\n\n\t\t\t\t\tobjects.push( newObjects[ j ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance nodes\n\n\t\t\tfor ( var i = 0, l = instanceNodes.length; i < l; i ++ ) {\n\n\t\t\t\tobjects.push( getNode( instanceNodes[ i ] ).clone() );\n\n\t\t\t}\n\n\t\t\tvar object;\n\n\t\t\tif ( nodes.length === 0 && objects.length === 1 ) {\n\n\t\t\t\tobject = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tobject = ( type === 'JOINT' ) ? new THREE.Bone() : new THREE.Group();\n\n\t\t\t\tfor ( var i = 0; i < objects.length; i ++ ) {\n\n\t\t\t\t\tobject.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( object.name === '' ) {\n\n\t\t\t\tobject.name = ( type === 'JOINT' ) ? data.sid : data.name;\n\n\t\t\t}\n\n\t\t\tobject.matrix.copy( matrix );\n\t\t\tobject.matrix.decompose( object.position, object.quaternion, object.scale );\n\n\t\t\treturn object;\n\n\t\t}\n\n\t\tvar fallbackMaterial = new THREE.MeshBasicMaterial( { color: 0xff00ff } );\n\n\t\tfunction resolveMaterialBinding( keys, instanceMaterials ) {\n\n\t\t\tvar materials = [];\n\n\t\t\tfor ( var i = 0, l = keys.length; i < l; i ++ ) {\n\n\t\t\t\tvar id = instanceMaterials[ keys[ i ] ];\n\n\t\t\t\tif ( id === undefined ) {\n\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Material with key %s not found. Apply fallback material.', keys[ i ] );\n\t\t\t\t\tmaterials.push( fallbackMaterial );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tmaterials.push( getMaterial( id ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn materials;\n\n\t\t}\n\n\t\tfunction buildObjects( geometries, instanceMaterials ) {\n\n\t\t\tvar objects = [];\n\n\t\t\tfor ( var type in geometries ) {\n\n\t\t\t\tvar geometry = geometries[ type ];\n\n\t\t\t\tvar materials = resolveMaterialBinding( geometry.materialKeys, instanceMaterials );\n\n\t\t\t\t// handle case if no materials are defined\n\n\t\t\t\tif ( materials.length === 0 ) {\n\n\t\t\t\t\tif ( type === 'lines' || type === 'linestrips' ) {\n\n\t\t\t\t\t\tmaterials.push( new THREE.LineBasicMaterial() );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tmaterials.push( new THREE.MeshPhongMaterial() );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// regard skinning\n\n\t\t\t\tvar skinning = ( geometry.data.attributes.skinIndex !== undefined );\n\n\t\t\t\tif ( skinning ) {\n\n\t\t\t\t\tfor ( var i = 0, l = materials.length; i < l; i ++ ) {\n\n\t\t\t\t\t\tmaterials[ i ].skinning = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// choose between a single or multi materials (material array)\n\n\t\t\t\tvar material = ( materials.length === 1 ) ? materials[ 0 ] : materials;\n\n\t\t\t\t// now create a specific 3D object\n\n\t\t\t\tvar object;\n\n\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\tcase 'lines':\n\t\t\t\t\t\tobject = new THREE.LineSegments( geometry.data, material );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'linestrips':\n\t\t\t\t\t\tobject = new THREE.Line( geometry.data, material );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'triangles':\n\t\t\t\t\tcase 'polylist':\n\t\t\t\t\t\tif ( skinning ) {\n\n\t\t\t\t\t\t\tobject = new THREE.SkinnedMesh( geometry.data, material );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tobject = new THREE.Mesh( geometry.data, material );\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tobjects.push( object );\n\n\t\t\t}\n\n\t\t\treturn objects;\n\n\t\t}\n\n\t\tfunction hasNode( id ) {\n\n\t\t\treturn library.nodes[ id ] !== undefined;\n\n\t\t}\n\n\t\tfunction getNode( id ) {\n\n\t\t\treturn getBuild( library.nodes[ id ], buildNode );\n\n\t\t}\n\n\t\t// visual scenes\n\n\t\tfunction parseVisualScene( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' ),\n\t\t\t\tchildren: []\n\t\t\t};\n\n\t\t\tprepareNodes( xml );\n\n\t\t\tvar elements = getElementsByTagName( xml, 'node' );\n\n\t\t\tfor ( var i = 0; i < elements.length; i ++ ) {\n\n\t\t\t\tdata.children.push( parseNode( elements[ i ] ) );\n\n\t\t\t}\n\n\t\t\tlibrary.visualScenes[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildVisualScene( data ) {\n\n\t\t\tvar group = new THREE.Group();\n\t\t\tgroup.name = data.name;\n\n\t\t\tvar children = data.children;\n\n\t\t\tfor ( var i = 0; i < children.length; i ++ ) {\n\n\t\t\t\tvar child = children[ i ];\n\n\t\t\t\tgroup.add( getNode( child.id ) );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t}\n\n\t\tfunction hasVisualScene( id ) {\n\n\t\t\treturn library.visualScenes[ id ] !== undefined;\n\n\t\t}\n\n\t\tfunction getVisualScene( id ) {\n\n\t\t\treturn getBuild( library.visualScenes[ id ], buildVisualScene );\n\n\t\t}\n\n\t\t// scenes\n\n\t\tfunction parseScene( xml ) {\n\n\t\t\tvar instance = getElementsByTagName( xml, 'instance_visual_scene' )[ 0 ];\n\t\t\treturn getVisualScene( parseId( instance.getAttribute( 'url' ) ) );\n\n\t\t}\n\n\t\tfunction setupAnimations() {\n\n\t\t\tvar clips = library.clips;\n\n\t\t\tif ( isEmpty( clips ) === true ) {\n\n\t\t\t\tif ( isEmpty( library.animations ) === false ) {\n\n\t\t\t\t\t// if there are animations but no clips, we create a default clip for playback\n\n\t\t\t\t\tvar tracks = [];\n\n\t\t\t\t\tfor ( var id in library.animations ) {\n\n\t\t\t\t\t\tvar animationTracks = getAnimation( id );\n\n\t\t\t\t\t\tfor ( var i = 0, l = animationTracks.length; i < l; i ++ ) {\n\n\t\t\t\t\t\t\ttracks.push( animationTracks[ i ] );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tanimations.push( new THREE.AnimationClip( 'default', - 1, tracks ) );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfor ( var id in clips ) {\n\n\t\t\t\t\tanimations.push( getAnimationClip( id ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// convert the parser error element into text with each child elements text\n\t\t// separated by new lines.\n\n\t\tfunction parserErrorToText( parserError ) {\n\n\t\t\tvar result = '';\n\t\t\tvar stack = [ parserError ];\n\n\t\t\twhile ( stack.length ) {\n\n\t\t\t\tvar node = stack.shift();\n\n\t\t\t\tif ( node.nodeType === Node.TEXT_NODE ) {\n\n\t\t\t\t\tresult += node.textContent;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tresult += '\\n';\n\t\t\t\t\tstack.push.apply( stack, node.childNodes );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn result.trim();\n\n\t\t}\n\n\t\tif ( text.length === 0 ) {\n\n\t\t\treturn { scene: new THREE.Scene() };\n\n\t\t}\n\n\t\tvar xml = new DOMParser().parseFromString( text, 'application/xml' );\n\n\t\tvar collada = getElementsByTagName( xml, 'COLLADA' )[ 0 ];\n\n\t\tvar parserError = xml.getElementsByTagName( 'parsererror' )[ 0 ];\n\t\tif ( parserError !== undefined ) {\n\n\t\t\t// Chrome will return parser error with a div in it\n\n\t\t\tvar errorElement = getElementsByTagName( parserError, 'div' )[ 0 ];\n\t\t\tvar errorText;\n\n\t\t\tif ( errorElement ) {\n\n\t\t\t\terrorText = errorElement.textContent;\n\n\t\t\t} else {\n\n\t\t\t\terrorText = parserErrorToText( parserError );\n\n\t\t\t}\n\n\t\t\tconsole.error( 'THREE.ColladaLoader: Failed to parse collada file.\\n', errorText );\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// metadata\n\n\t\tvar version = collada.getAttribute( 'version' );\n\t\tconsole.log( 'THREE.ColladaLoader: File version', version );\n\n\t\tvar asset = parseAsset( getElementsByTagName( collada, 'asset' )[ 0 ] );\n\t\tvar textureLoader = new THREE.TextureLoader( this.manager );\n\t\ttextureLoader.setPath( this.resourcePath || path ).setCrossOrigin( this.crossOrigin );\n\n\t\tvar tgaLoader;\n\n\t\tif ( THREE.TGALoader ) {\n\n\t\t\ttgaLoader = new THREE.TGALoader( this.manager );\n\t\t\ttgaLoader.setPath( this.resourcePath || path );\n\n\t\t}\n\n\t\t//\n\n\t\tvar animations = [];\n\t\tvar kinematics = {};\n\t\tvar count = 0;\n\n\t\t//\n\n\t\tvar library = {\n\t\t\tanimations: {},\n\t\t\tclips: {},\n\t\t\tcontrollers: {},\n\t\t\timages: {},\n\t\t\teffects: {},\n\t\t\tmaterials: {},\n\t\t\tcameras: {},\n\t\t\tlights: {},\n\t\t\tgeometries: {},\n\t\t\tnodes: {},\n\t\t\tvisualScenes: {},\n\t\t\tkinematicsModels: {},\n\t\t\tphysicsModels: {},\n\t\t\tkinematicsScenes: {}\n\t\t};\n\n\t\tparseLibrary( collada, 'library_animations', 'animation', parseAnimation );\n\t\tparseLibrary( collada, 'library_animation_clips', 'animation_clip', parseAnimationClip );\n\t\tparseLibrary( collada, 'library_controllers', 'controller', parseController );\n\t\tparseLibrary( collada, 'library_images', 'image', parseImage );\n\t\tparseLibrary( collada, 'library_effects', 'effect', parseEffect );\n\t\tparseLibrary( collada, 'library_materials', 'material', parseMaterial );\n\t\tparseLibrary( collada, 'library_cameras', 'camera', parseCamera );\n\t\tparseLibrary( collada, 'library_lights', 'light', parseLight );\n\t\tparseLibrary( collada, 'library_geometries', 'geometry', parseGeometry );\n\t\tparseLibrary( collada, 'library_nodes', 'node', parseNode );\n\t\tparseLibrary( collada, 'library_visual_scenes', 'visual_scene', parseVisualScene );\n\t\tparseLibrary( collada, 'library_kinematics_models', 'kinematics_model', parseKinematicsModel );\n\t\tparseLibrary( collada, 'library_physics_models', 'physics_model', parsePhysicsModel );\n\t\tparseLibrary( collada, 'scene', 'instance_kinematics_scene', parseKinematicsScene );\n\n\t\tbuildLibrary( library.animations, buildAnimation );\n\t\tbuildLibrary( library.clips, buildAnimationClip );\n\t\tbuildLibrary( library.controllers, buildController );\n\t\tbuildLibrary( library.images, buildImage );\n\t\tbuildLibrary( library.effects, buildEffect );\n\t\tbuildLibrary( library.materials, buildMaterial );\n\t\tbuildLibrary( library.cameras, buildCamera );\n\t\tbuildLibrary( library.lights, buildLight );\n\t\tbuildLibrary( library.geometries, buildGeometry );\n\t\tbuildLibrary( library.visualScenes, buildVisualScene );\n\n\t\tsetupAnimations();\n\t\tsetupKinematics();\n\n\t\tvar scene = parseScene( getElementsByTagName( collada, 'scene' )[ 0 ] );\n\n\t\tif ( asset.upAxis === 'Z_UP' ) {\n\n\t\t\tscene.quaternion.setFromEuler( new THREE.Euler( - Math.PI / 2, 0, 0 ) );\n\n\t\t}\n\n\t\tscene.scale.multiplyScalar( asset.unit );\n\n\t\treturn {\n\t\t\tanimations: animations,\n\t\t\tkinematics: kinematics,\n\t\t\tlibrary: library,\n\t\t\tscene: scene\n\t\t};\n\n\t}\n\n} );\n"]}