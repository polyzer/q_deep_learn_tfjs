{"version":3,"sources":["src/src/js/ComputerMobileControls.js"],"names":["THREEx","ComputerMobileControls","json_params","Camera","Error","MovingSpeed","RotationSpeed","touchUpdate","bind","OrientationParameters","alpha","beta","gamma","deviceMotionInterval","touchRotRadX","touchRotRadY","touchDeltaTime","shakeTimer","shakeTimerStep","DEVICE_TYPES","DESKTOP","MOBILE","testExp","RegExp","test","navigator","userAgent","DeviceType","AccelerometerControlButton","document","createElement","setAttribute","className","TouchControlButton","addEventListener","style","visibility","RotateHammer","enable","update","accelerometerUpdate","FrontMovingButton","onmousedown","event","FrontMovingOn","ontouchstart","onmouseup","ontouchend","BackMovingButton","BackMovingOn","Hammer","body","get","set","direction","DIRECTION_ALL","on","THREE","Math","degToRad","deltaX","deltaY","deltaTime","AccelerometerControls","DeviceOrientationControls","window","DeviceMotionEvent","undefined","appendChild","onDeviceMotion","onDeviceOrientation","contains","removeChild","prototype","delta","AntiVec","getWorldDirection","normalize","multiplyScalar","position","add","rotation","y","x","abs","rotationRate","interval","phi","theta"],"mappings":"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","file":"ComputerMobileControls.map","sourceRoot":"..","sourcesContent":["/*\r\nSkyFox Team Controller.\r\nOn Desktop computer version we use THREE.FlyControls.\r\nOn Mobile phones we using Our Controls System.\r\n\r\nIN: \r\njson_params = {\r\n\tCamera: THREE.Camera\r\n};\r\n*/\r\nvar THREEx = THREEx || {};\r\nTHREEx.ComputerMobileControls = function (json_params)\r\n{\r\n\tif(json_params)\r\n\t{\r\n\t\tif(json_params.Camera)\r\n\t\t\tthis.Camera = json_params.Camera;\r\n\t\telse\r\n\t\t\tthrow new Error(\"We have no Camera!\");\r\n\t\t\r\n\t\tif(json_params.MovingSpeed)\r\n\t\t\tthis.MovingSpeed = json_params.MovingSpeed;\r\n\t\telse\r\n\t\t\tthis.MovingSpeed = 100;\r\n\r\n\t\tif(json_params.RotationSpeed)\r\n\t\t\tthis.RotationSpeed = json_params.RotationSpeed;\r\n\t\telse\r\n\t\t\tthis.RotationSpeed = 30;\t\t\t\r\n\t}\r\n\tthis.touchUpdate = this.touchUpdate.bind(this);\r\n\r\n\tthis.OrientationParameters = {\r\n\t\talpha: 0,\r\n\t\tbeta: 0,\r\n\t\tgamma: 0,\r\n\t\tdeviceMotionInterval: 0,\r\n\t\t\r\n\t\ttouchRotRadX: 0,\r\n\t\ttouchRotRadY: 0,\r\n\t\ttouchDeltaTime: 0,\r\n\t\t\r\n\t\tshakeTimer: 0,\r\n\t\tshakeTimerStep: 0.1\r\n\t};\r\n\r\n\tthis.DEVICE_TYPES = {\r\n\t\tDESKTOP: 0,\r\n\t\tMOBILE: 1\r\n\t};\r\n\r\n \tvar testExp = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    \t\t       'BlackBerry|Windows Phone|'  +\r\n    \t\t       'Opera Mini|IEMobile|Mobile' , \r\n    \t\t      'i');\r\n  \r\n    if (testExp.test(navigator.userAgent)){\r\n    \tthis.DeviceType = this.DEVICE_TYPES.MOBILE;\r\n    }else{\r\n    \tthis.DeviceType = this.DEVICE_TYPES.DESKTOP;\r\n    }\r\n\r\n\r\n\tthis.AccelerometerControlButton = document.createElement(\"button\");\r\n\tthis.AccelerometerControlButton.setAttribute(\"id\", \"AccelerometerControlButton\");\r\n    this.AccelerometerControlButton.className = \"AccelerometerControlButton\";\r\n    // document.body.appendChild(this.AccelerometerControlButton);\r\n\r\n\tthis.TouchControlButton = document.createElement(\"button\");\r\n\tthis.TouchControlButton.setAttribute(\"id\", \"TouchControlButton\");\r\n    this.TouchControlButton.className = \"TouchControlButton\";\r\n    // document.body.appendChild(this.TouchControlButton);\r\n\r\n\tthis.AccelerometerControlButton.addEventListener(\"click\", function () {\r\n\t\tthis.TouchControlButton.style.visibility = \"visible\";\r\n\t\tthis.AccelerometerControlButton.style.visibility = \"hidden\";\r\n\t\tthis.RotateHammer.enable = false;\r\n\t\tthis.update = this.accelerometerUpdate;\r\n\t}.bind(this));\r\n\r\n\tthis.TouchControlButton.addEventListener(\"click\", function () {\r\n\t\tthis.TouchControlButton.style.visibility = \"hidden\";\r\n\t\tthis.AccelerometerControlButton.style.visibility = \"visible\";\r\n\t\tthis.RotateHammer.enable = true;\r\n\t\tthis.update = this.touchUpdate;\r\n\t}.bind(this));\r\n\r\n\tthis.FrontMovingButton = document.createElement(\"div\");\r\n\tthis.FrontMovingButton.setAttribute(\"id\", \"FrontMovingButton\");\r\n    this.FrontMovingButton.className = \"FrontMovingButton\";\r\n\t// document.body.appendChild(this.FrontMovingButton);\r\n\r\n\tthis.FrontMovingButton.onmousedown = function (event)\r\n\t{\r\n\t \tthis.FrontMovingOn = true;\r\n\t}.bind(this);\r\n\r\n\tthis.FrontMovingButton.ontouchstart = function (event)\r\n\t{\r\n\t \tthis.FrontMovingOn = true;\r\n\t}.bind(this);\r\n\r\n\tthis.FrontMovingButton.onmouseup = function (event)\r\n\t{\r\n\t \tthis.FrontMovingOn = false;\r\n\t}.bind(this);\r\n\r\n\tthis.FrontMovingButton.ontouchend = function (event)\r\n\t{\r\n\t \tthis.FrontMovingOn = false;\r\n\t}.bind(this);\r\n\r\n\tthis.BackMovingButton = document.createElement(\"div\");\r\n\tthis.BackMovingButton.setAttribute(\"id\", \"BackMovingButton\");\r\n    this.BackMovingButton.className = \"BackMovingButton\";\r\n\t// document.body.appendChild(this.BackMovingButton);\r\n\r\n\tthis.BackMovingButton.onmousedown = function (event)\r\n\t{\r\n\t \tthis.BackMovingOn = true;\r\n\t}.bind(this);\r\n\r\n\tthis.BackMovingButton.ontouchstart = function (event)\r\n\t{\r\n\t \tthis.BackMovingOn = true;\r\n\t}.bind(this);\r\n\r\n\tthis.BackMovingButton.onmouseup = function (event)\r\n\t{\r\n\t \tthis.BackMovingOn = false;\r\n\t}.bind(this);\r\n\r\n\tthis.BackMovingButton.ontouchend = function (event)\r\n\t{\r\n\t \tthis.BackMovingOn = false;\r\n\t}.bind(this);\r\n\r\n\r\n\r\n\t//mouse/touch controller\r\n\tthis.RotateHammer = new Hammer(document.body);\r\n\tthis.RotateHammer.get('pan').set({ direction: Hammer.DIRECTION_ALL });\r\n\tthis.RotateHammer.on(\"pan\", function (event) {\r\n\r\n\t\tthis.OrientationParameters.touchRotRadX = THREE.Math.degToRad(event.deltaX/this.RotationSpeed);\r\n\t\tthis.OrientationParameters.touchRotRadY = THREE.Math.degToRad(event.deltaY/this.RotationSpeed);\r\n\t\tthis.OrientationParameters.touchDeltaTime = event.deltaTime;\r\n\r\n\t}.bind(this));\r\n\r\n\r\n\tthis.AccelerometerControls = new THREE.DeviceOrientationControls(this.Camera);\r\n\tthis.update = this.accelerometerUpdate;\r\n\r\n\tif (window.DeviceMotionEvent !== undefined || this.DeviceType === this.DEVICE_TYPES.MOBILE) {\r\n\t\tdocument.body.appendChild(this.BackMovingButton);\r\n\t    document.body.appendChild(this.AccelerometerControlButton);\r\n\t    document.body.appendChild(this.TouchControlButton);\r\n\t\tdocument.body.appendChild(this.FrontMovingButton);\r\n\r\n\t\tthis.RotateHammer.enable = false;\r\n\t\tthis.update = this.accelerometerUpdate;\r\n\r\n\t\twindow.addEventListener(\"devicemotion\", this.onDeviceMotion.bind(this));\t\t\t\r\n\t\twindow.addEventListener(\"deviceorientation\", this.onDeviceOrientation.bind(this));\t\t\t\t\t\r\n\t} else {\r\n\t\tif(document.body.contains(this.AccelerometerControlButton))\r\n\t\t\tdocument.body.removeChild(this.AccelerometerControlButton);\r\n\t\tif(document.body.contains(this.TouchControlButton))\r\n\t\t\tdocument.body.removeChild(this.TouchControlButton);\r\n\t\tthis.RotateHammer.enable = true;\r\n\t\tthis.update = this.touchUpdate;\r\n\t}\r\n\r\n};\r\n\r\nTHREEx.ComputerMobileControls.prototype.accelerometerUpdate  = function (delta)\r\n{\r\n\tthis.AccelerometerControls.update();\r\n\t\r\n\tif(this.FrontMovingOn)\r\n\t{\r\n\t\tthis.AntiVec = this.Camera.getWorldDirection();\r\n\t\tthis.AntiVec.normalize();\r\n\t\tthis.AntiVec.multiplyScalar(this.MovingSpeed);\r\n\t\tthis.Camera.position.add(this.AntiVec);\t\t\t\t\r\n\t}\r\n\r\n\tif(this.BackMovingOn)\r\n\t{\r\n\t\tthis.AntiVec = this.Camera.getWorldDirection();\r\n\t\tthis.AntiVec.normalize();\r\n\t\tthis.AntiVec.multiplyScalar(-this.MovingSpeed);\r\n\t\tthis.Camera.position.add(this.AntiVec);\t\t\t\t\r\n\t}\r\n};\r\n\r\nTHREEx.ComputerMobileControls.prototype.touchUpdate = function(delta)\r\n{\r\n\r\n\tthis.Camera.rotation.y -= this.OrientationParameters.touchRotRadX*delta;\r\n\tthis.Camera.rotation.x -= this.OrientationParameters.touchRotRadY*delta;\t\r\n\r\n\r\n\tif(Math.abs(this.OrientationParameters.touchRotRadX) > 0.005)\r\n\t{\r\n\t\tthis.OrientationParameters.touchRotRadX -= this.OrientationParameters.touchRotRadX/10;\t\t\t\r\n\t} else if(this.OrientationParameters.touchRotRadX)\r\n\t\tthis.OrientationParameters.touchRotRadX = 0;\r\n\r\n\tif(Math.abs(this.OrientationParameters.touchRotRadY) > 0.005)\r\n\t{\r\n\t\tthis.OrientationParameters.touchRotRadY -= this.OrientationParameters.touchRotRadY/10;\t\t\t\r\n\t} else if(this.OrientationParameters.touchRotRadY)\r\n\t\tthis.OrientationParameters.touchRotRadY = 0;\t\r\n\r\n\tif(this.FrontMovingOn)\r\n\t{\r\n\t\tthis.AntiVec = this.Camera.getWorldDirection();\r\n\t\tthis.AntiVec.normalize();\r\n\t\tthis.AntiVec.multiplyScalar(this.MovingSpeed);\r\n\t\tthis.Camera.position.add(this.AntiVec);\t\t\t\t\r\n\t}\r\n\r\n\tif(this.BackMovingOn)\r\n\t{\r\n\t\tthis.AntiVec = this.Camera.getWorldDirection();\r\n\t\tthis.AntiVec.normalize();\r\n\t\tthis.AntiVec.multiplyScalar(-this.MovingSpeed);\r\n\t\tthis.Camera.position.add(this.AntiVec);\t\t\t\t\r\n\t}\r\n};\r\n\r\n\r\n// Наш обработчик ускорения\r\nTHREEx.ComputerMobileControls.prototype.onDeviceMotion = function (event) {\r\n\r\n\tthis.OrientationParameters.alpha = event.rotationRate.alpha;\r\n\tthis.OrientationParameters.beta = -event.rotationRate.beta;\r\n\tthis.OrientationParameters.deviceMotionInterval = event.interval;\r\n\r\n\tthis.OrientationParameters.phi = 0;\r\n\tthis.OrientationParameters.theta = 0;\r\n};\r\n\r\n// Наш обработчик ускорения\r\nTHREEx.ComputerMobileControls.prototype.onDeviceOrientation = function (event) {\r\n\r\n\tthis.OrientationParameters.alpha = event.alpha;\r\n\tthis.OrientationParameters.beta = -event.beta;\r\n\tthis.OrientationParameters.deviceMotionInterval = event.interval;\r\n\r\n\tthis.OrientationParameters.phi = 0;\r\n\tthis.OrientationParameters.theta = 0;\r\n};"]}